
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  
  <!-- Licensed under the Apache 2.0 License -->
  <link rel="stylesheet" type="text/css" href="../_static/fonts/open-sans/stylesheet.css" />
  <!-- Licensed under the SIL Open Font License -->
  <link rel="stylesheet" type="text/css" href="../_static/fonts/source-serif-pro/source-serif-pro.css" />
  <link rel="stylesheet" type="text/css" href="../_static/css/bootstrap.min.css" />
  <link rel="stylesheet" type="text/css" href="../_static/css/bootstrap-theme.min.css" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
    <title>fgrid &#8212; PyFEHM 1.0.4 documentation</title>
    <link rel="stylesheet" href="../_static/guzzle.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
  
   

  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">PyFEHM 1.0.4 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>
    <div class="container-wrapper">

      <div id="mobile-toggle">
        <a href="#"><span class="glyphicon glyphicon-align-justify" aria-hidden="true"></span></a>
      </div>
  <div id="left-column">
    <div class="sphinxsidebar"><a href="
    ../index.html" class="text-logo">PyFEHM</a>
<div class="sidebar-block">
  <div class="sidebar-wrapper">
    <h2>Table Of Contents</h2>
  </div>
  <div class="sidebar-toc">
    
    
      <ul>
<li class="toctree-l1"><a class="reference internal" href="../intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fgrid.html">fgrid: FEHM grid manipulation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fdata.html">fdata: FEHM input file manipulation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fpost.html">fpost: FEHM output file manipulation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fvars.html">fvars: FEHM thermodynamic calculations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial.html">Tutorials</a></li>
</ul>

    
  </div>
</div>
<div class="sidebar-block">
  <div class="sidebar-wrapper">
    <div id="main-search">
      <form class="form-inline" action="../search.html" method="GET" role="form">
        <div class="input-group">
          <input name="q" type="text" class="form-control" placeholder="Search...">
        </div>
        <input type="hidden" name="check_keywords" value="yes" />
        <input type="hidden" name="area" value="default" />
      </form>
    </div>
  </div>
</div>
      
    </div>
  </div>
        <div id="right-column">
          
          <div role="navigation" aria-label="breadcrumbs navigation">
            <ol class="breadcrumb">
              <li><a href="../index.html">Docs</a></li>
              
                <li><a href="index.html">Module code</a></li>
              
              <li>fgrid</li>
            </ol>
          </div>
          
          <div class="document clearer body">
            
  <h1>Source code for fgrid</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;For manipulating FEHM grids.&quot;&quot;&quot;</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Copyright 2013.</span>
<span class="sd">Los Alamos National Security, LLC. </span>
<span class="sd">This material was produced under U.S. Government contract DE-AC52-06NA25396 for </span>
<span class="sd">Los Alamos National Laboratory (LANL), which is operated by Los Alamos National </span>
<span class="sd">Security, LLC for the U.S. Department of Energy. The U.S. Government has rights </span>
<span class="sd">to use, reproduce, and distribute this software.  NEITHER THE GOVERNMENT NOR LOS </span>
<span class="sd">ALAMOS NATIONAL SECURITY, LLC MAKES ANY WARRANTY, EXPRESS OR IMPLIED, OR ASSUMES </span>
<span class="sd">ANY LIABILITY FOR THE USE OF THIS SOFTWARE.  If software is modified to produce </span>
<span class="sd">derivative works, such modified software should be clearly marked, so as not to </span>
<span class="sd">confuse it with the version available from LANL.</span>

<span class="sd">Additionally, this library is free software; you can redistribute it and/or modify </span>
<span class="sd">it under the terms of the GNU Lesser General Public License as published by the </span>
<span class="sd">Free Software Foundation; either version 2.1 of the License, or (at your option) </span>
<span class="sd">any later version. Accordingly, this library is distributed in the hope that it </span>
<span class="sd">will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of </span>
<span class="sd">MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Lesser General </span>
<span class="sd">Public License for more details.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">os</span><span class="o">,</span><span class="nn">math</span><span class="o">,</span><span class="nn">platform</span><span class="o">,</span><span class="nn">string</span><span class="o">,</span><span class="nn">subprocess</span><span class="o">,</span><span class="nn">shutil</span>
<span class="kn">from</span> <span class="nn">subprocess</span> <span class="k">import</span> <span class="n">Popen</span>

<span class="kn">from</span> <span class="nn">time</span> <span class="k">import</span> <span class="n">time</span>
<span class="kn">from</span> <span class="nn">copy</span> <span class="k">import</span> <span class="n">deepcopy</span>
<span class="kn">from</span> <span class="nn">glob</span> <span class="k">import</span> <span class="n">glob</span>

<span class="k">try</span><span class="p">:</span>
	<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="k">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
	<span class="kn">from</span> <span class="nn">mpl_toolkits.mplot3d</span> <span class="k">import</span> <span class="n">axes3d</span>
	<span class="kn">from</span> <span class="nn">scipy</span> <span class="k">import</span> <span class="n">spatial</span> <span class="k">as</span> <span class="n">spsp</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
	<span class="s1">&#39;placeholder&#39;</span>
	
<span class="kn">from</span> <span class="nn">fpost</span> <span class="k">import</span><span class="o">*</span>
<span class="kn">from</span> <span class="nn">ftool</span> <span class="k">import</span><span class="o">*</span>

<span class="n">dflt</span> <span class="o">=</span> <span class="n">fdflt</span><span class="p">()</span>

<span class="n">WINDOWS</span> <span class="o">=</span> <span class="n">platform</span><span class="o">.</span><span class="n">system</span><span class="p">()</span><span class="o">==</span><span class="s1">&#39;Windows&#39;</span>
<span class="k">if</span> <span class="n">WINDOWS</span><span class="p">:</span> <span class="n">slash</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span>
<span class="k">else</span><span class="p">:</span> <span class="n">slash</span> <span class="o">=</span> <span class="s1">&#39;/&#39;</span>

<span class="n">node_props</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;kx&#39;</span><span class="p">,</span><span class="s1">&#39;ky&#39;</span><span class="p">,</span><span class="s1">&#39;kz&#39;</span><span class="p">,</span><span class="s1">&#39;cond_x&#39;</span><span class="p">,</span><span class="s1">&#39;cond_y&#39;</span><span class="p">,</span><span class="s1">&#39;cond_z&#39;</span><span class="p">,</span><span class="s1">&#39;density&#39;</span><span class="p">,</span><span class="s1">&#39;specific_heat&#39;</span><span class="p">,</span><span class="s1">&#39;porosity&#39;</span><span class="p">,</span><span class="s1">&#39;thermal_expansion&#39;</span><span class="p">,</span><span class="s1">&#39;pressure_coupling&#39;</span><span class="p">,</span>
<span class="s1">&#39;youngs_modulus&#39;</span><span class="p">,</span><span class="s1">&#39;poissons_ratio&#39;</span><span class="p">)</span>

<span class="n">nbr_update</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">((</span>
	<span class="p">(</span><span class="mi">0</span><span class="p">,[[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">],[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">]]),</span>
	<span class="p">(</span><span class="mi">1</span><span class="p">,[[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">]]),</span>
	<span class="p">(</span><span class="mi">2</span><span class="p">,[[</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">],[</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">6</span><span class="p">]]),</span>
	<span class="p">(</span><span class="mi">3</span><span class="p">,[[</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">],[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">7</span><span class="p">]]),</span>
	<span class="p">(</span><span class="mi">4</span><span class="p">,[[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">5</span><span class="p">],[</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">0</span><span class="p">]]),</span>
	<span class="p">(</span><span class="mi">5</span><span class="p">,[[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">5</span><span class="p">],[</span><span class="mi">4</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">1</span><span class="p">]]),</span>
	<span class="p">(</span><span class="mi">6</span><span class="p">,[[</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">],[</span><span class="mi">7</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">]]),</span>
	<span class="p">(</span><span class="mi">7</span><span class="p">,[[</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">],[</span><span class="mi">6</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">3</span><span class="p">]])</span>
	<span class="p">))</span>
<span class="k">def</span> <span class="nf">repair_grid</span><span class="p">(</span><span class="n">gridfilename</span><span class="p">):</span>
	<span class="n">geo</span> <span class="o">=</span> <span class="n">fgrid</span><span class="p">()</span>
	<span class="n">geo</span><span class="o">.</span><span class="n">_read_inp</span><span class="p">(</span><span class="n">gridfilename</span><span class="p">)</span>
	<span class="nb">print</span> <span class="s1">&#39;The following duplicates were removed...&#39;</span>
	<span class="c1"># with the repair flag, duplicate nodes will be deleted</span>
	<span class="n">geo</span><span class="o">.</span><span class="n">add_nodetree</span><span class="p">(</span><span class="n">repair</span> <span class="o">=</span> <span class="n">geo</span><span class="p">)</span>
	<span class="c1"># now need to renumber nodes</span>
	<span class="n">i0</span> <span class="o">=</span> <span class="n">geo</span><span class="o">.</span><span class="n">_nodelist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">index</span>
	<span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">nd</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">geo</span><span class="o">.</span><span class="n">_nodelist</span><span class="p">[</span><span class="mi">1</span><span class="p">:]):</span>
		<span class="n">di</span> <span class="o">=</span> <span class="n">nd</span><span class="o">.</span><span class="n">index</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">i0</span>
		<span class="k">if</span> <span class="n">di</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
			<span class="k">for</span> <span class="n">nd2</span> <span class="ow">in</span> <span class="n">geo</span><span class="o">.</span><span class="n">_nodelist</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">:]:</span>
				<span class="n">nd2</span><span class="o">.</span><span class="n">_index</span> <span class="o">-=</span> <span class="n">di</span>
		<span class="n">i0</span> <span class="o">=</span> <span class="n">nd</span><span class="o">.</span><span class="n">index</span>
	
	<span class="n">newgridfilename</span> <span class="o">=</span> <span class="n">gridfilename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;.repaired&#39;</span> 
	<span class="nb">print</span> <span class="s1">&#39;Writing repaired grid file &#39;</span><span class="o">+</span><span class="n">newgridfilename</span>
	<span class="n">geo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">newgridfilename</span><span class="p">)</span>
	<span class="n">geo</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">newgridfilename</span><span class="p">)</span>
	<span class="k">return</span> <span class="n">geo</span>
<div class="viewcode-block" id="fnode"><a class="viewcode-back" href="../fgrid.html#fgrid.fnode">[docs]</a><span class="k">class</span> <span class="nc">fnode</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>				<span class="c1">#Node object.</span>
	<span class="sd">&quot;&quot;&quot; FEHM grid node object.</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="vm">__slots__</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;_index&#39;</span><span class="p">,</span><span class="s1">&#39;_position&#39;</span><span class="p">,</span><span class="s1">&#39;_connections&#39;</span><span class="p">,</span><span class="s1">&#39;_elements&#39;</span><span class="p">,</span><span class="s1">&#39;_generator&#39;</span><span class="p">,</span><span class="s1">&#39;_zone&#39;</span><span class="p">,</span>
		<span class="s1">&#39;_permeability&#39;</span><span class="p">,</span><span class="s1">&#39;_conductivity&#39;</span><span class="p">,</span><span class="s1">&#39;_density&#39;</span><span class="p">,</span><span class="s1">&#39;_specific_heat&#39;</span><span class="p">,</span><span class="s1">&#39;_porosity&#39;</span><span class="p">,</span><span class="s1">&#39;_youngs_modulus&#39;</span><span class="p">,</span><span class="s1">&#39;_poissons_ratio&#39;</span><span class="p">,</span><span class="s1">&#39;_thermal_expansion&#39;</span><span class="p">,</span>
		<span class="s1">&#39;_pressure_coupling&#39;</span><span class="p">,</span><span class="s1">&#39;_Pi&#39;</span><span class="p">,</span><span class="s1">&#39;_Ti&#39;</span><span class="p">,</span><span class="s1">&#39;_Si&#39;</span><span class="p">,</span><span class="s1">&#39;_S_co2gi&#39;</span><span class="p">,</span><span class="s1">&#39;_S_co2li&#39;</span><span class="p">,</span><span class="s1">&#39;_co2aqi&#39;</span><span class="p">,</span><span class="s1">&#39;_strsi&#39;</span><span class="p">,</span><span class="s1">&#39;_dispi&#39;</span><span class="p">,</span><span class="s1">&#39;_P&#39;</span><span class="p">,</span><span class="s1">&#39;_T&#39;</span><span class="p">,</span><span class="s1">&#39;_S&#39;</span><span class="p">,</span>
		<span class="s1">&#39;_S_co2g&#39;</span><span class="p">,</span><span class="s1">&#39;_S_co2l&#39;</span><span class="p">,</span><span class="s1">&#39;_co2aq&#39;</span><span class="p">,</span><span class="s1">&#39;_strs&#39;</span><span class="p">,</span><span class="s1">&#39;_disp&#39;</span><span class="p">,</span><span class="s1">&#39;_vol&#39;</span><span class="p">,</span><span class="s1">&#39;_rlpmodel&#39;</span><span class="p">,</span><span class="s1">&#39;_permmodel&#39;</span><span class="p">,</span><span class="s1">&#39;_pormodel&#39;</span><span class="p">,</span><span class="s1">&#39;_condmodel&#39;</span><span class="p">]</span>
	<span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">position</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>		
		<span class="bp">self</span><span class="o">.</span><span class="n">_index</span> <span class="o">=</span> <span class="n">index</span>			
		<span class="bp">self</span><span class="o">.</span><span class="n">_position</span><span class="o">=</span><span class="n">position</span>	
		<span class="bp">self</span><span class="o">.</span><span class="n">_connections</span> <span class="o">=</span> <span class="p">[]</span>	
		<span class="bp">self</span><span class="o">.</span><span class="n">_elements</span> <span class="o">=</span> <span class="p">[]</span>	
		<span class="bp">self</span><span class="o">.</span><span class="n">_generator</span> <span class="o">=</span> <span class="p">{}</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_zone</span> <span class="o">=</span> <span class="p">{}</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_permeability</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_conductivity</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_density</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_specific_heat</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_porosity</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_youngs_modulus</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_poissons_ratio</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_thermal_expansion</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_pressure_coupling</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_Pi</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_Ti</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_Si</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_S_co2gi</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_S_co2li</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_co2aqi</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_strsi</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_dispi</span> <span class="o">=</span> <span class="kc">None</span>	
		<span class="bp">self</span><span class="o">.</span><span class="n">_P</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_T</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_S</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_S_co2g</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_S_co2l</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_co2aq</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_strs</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_disp</span> <span class="o">=</span> <span class="kc">None</span>		
		<span class="bp">self</span><span class="o">.</span><span class="n">_vol</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_rlpmodel</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_permmodel</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_pormodel</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_condmodel</span> <span class="o">=</span> <span class="kc">None</span>
	<span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="s1">&#39;nd&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
	<span class="k">def</span> <span class="nf">__getstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="nb">dict</span><span class="p">((</span><span class="n">k</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__slots__</span><span class="p">)</span>
	<span class="k">def</span> <span class="nf">__setstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_dict</span><span class="p">):</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="ow">in</span> <span class="n">data_dict</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
			<span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
	<span class="k">def</span> <span class="nf">_get_index</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index</span>
	<span class="n">index</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_get_index</span><span class="p">)</span> <span class="c1">#: (*int*) Integer number denoting the node.	</span>
	<span class="k">def</span> <span class="nf">_get_position</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_position</span>
	<span class="n">position</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_get_position</span><span class="p">)</span> <span class="c1">#: (*lst[fl64]*) List of the node&#39;s coordinates in 2- or 3-D space.</span>
	<span class="k">def</span> <span class="nf">_get_zone</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_zone</span>
	<span class="k">def</span> <span class="nf">_set_zone</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">value</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">_zone</span> <span class="o">=</span> <span class="n">value</span>
	<span class="n">zone</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_get_zone</span><span class="p">,</span> <span class="n">_set_zone</span><span class="p">)</span> <span class="c1">#: (*dict*) Dictionary of zones to which the node belongs.</span>
	<span class="k">def</span> <span class="nf">_get_generator</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generator</span>
	<span class="k">def</span> <span class="nf">_set_generator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">value</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generator</span> <span class="o">=</span> <span class="n">value</span>
	<span class="n">generator</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_get_generator</span><span class="p">,</span> <span class="n">_set_generator</span><span class="p">)</span> <span class="c1">#: (*dict*) Dictionary of generator properties associated with node.</span>
	<span class="k">def</span> <span class="nf">_get_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="n">prntStr</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1"> Node number: &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
		<span class="n">prntStr</span><span class="o">+=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Geometric properties.......</span><span class="se">\n</span><span class="s1">&#39;</span>
		<span class="n">prntStr</span><span class="o">+=</span><span class="s1">&#39;          x = &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
		<span class="n">prntStr</span><span class="o">+=</span><span class="s1">&#39;          y = &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
		<span class="n">prntStr</span><span class="o">+=</span><span class="s1">&#39;          z = &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vol</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">prntStr</span><span class="o">+=</span><span class="s1">&#39;     volume = &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vol</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
		<span class="n">prntStr</span><span class="o">+=</span><span class="s1">&#39; neighbours = [&#39;</span>
		<span class="k">for</span> <span class="n">nd</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">connected_nodes</span><span class="p">:</span>	<span class="n">prntStr</span><span class="o">+=</span><span class="nb">str</span><span class="p">(</span><span class="n">nd</span><span class="o">.</span><span class="n">index</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;,&#39;</span>
		<span class="n">prntStr</span> <span class="o">=</span> <span class="n">prntStr</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;]</span><span class="se">\n</span><span class="s1">&#39;</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">zone</span><span class="p">:</span>
			<span class="n">prntStr</span><span class="o">+=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Zone membership............</span><span class="se">\n</span><span class="s1">&#39;</span>
			<span class="k">for</span> <span class="n">zn</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">zonelist</span><span class="p">:</span>
				<span class="n">prntStr</span><span class="o">+=</span><span class="s1">&#39;    &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">zn</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
				<span class="k">if</span> <span class="n">zn</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
					<span class="n">prntStr</span><span class="o">+=</span><span class="s1">&#39;: &#39;</span><span class="o">+</span><span class="n">zn</span><span class="o">.</span><span class="n">name</span>
				<span class="n">prntStr</span><span class="o">+=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
		<span class="c1">#if self.variable:</span>
		<span class="n">prntStr</span><span class="o">+=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">State......................</span><span class="se">\n</span><span class="s1">&#39;</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ti</span><span class="p">:</span> 
			<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ti</span><span class="p">:</span>
				<span class="n">prntStr</span><span class="o">+=</span><span class="s1">&#39;temperature = &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; (init: &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ti</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;)</span><span class="se">\n</span><span class="s1">&#39;</span>
			<span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">:</span>
				<span class="n">prntStr</span><span class="o">+=</span><span class="s1">&#39;temperature = &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
			<span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ti</span><span class="p">:</span>
				<span class="n">prntStr</span><span class="o">+=</span><span class="s1">&#39;temperature = &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ti</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; (initial)</span><span class="se">\n</span><span class="s1">&#39;</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">P</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">Pi</span><span class="p">:</span> 
			<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">P</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">Pi</span><span class="p">:</span>
				<span class="n">prntStr</span><span class="o">+=</span><span class="s1">&#39;   pressure = &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; (init: &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Pi</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;)</span><span class="se">\n</span><span class="s1">&#39;</span>
			<span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="p">:</span>
				<span class="n">prntStr</span><span class="o">+=</span><span class="s1">&#39;   pressure = &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
			<span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">Pi</span><span class="p">:</span>
				<span class="n">prntStr</span><span class="o">+=</span><span class="s1">&#39;   pressure = &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Pi</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; (initial)</span><span class="se">\n</span><span class="s1">&#39;</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">S</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">Si</span><span class="p">:</span> 
			<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">S</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">Si</span><span class="p">:</span>
				<span class="n">prntStr</span><span class="o">+=</span><span class="s1">&#39;  sat water = &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">S</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; (init: &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Si</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;)</span><span class="se">\n</span><span class="s1">&#39;</span>
			<span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">S</span><span class="p">:</span>
				<span class="n">prntStr</span><span class="o">+=</span><span class="s1">&#39;  sat water = &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">S</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
			<span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">Si</span><span class="p">:</span>
				<span class="n">prntStr</span><span class="o">+=</span><span class="s1">&#39;  sat water = &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Si</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; (initial)</span><span class="se">\n</span><span class="s1">&#39;</span>
			<span class="c1">#if &#39;S_co2g&#39; in keys: prntStr+=&#39;sat co2 gas = &#39;+str(self.variable[&#39;S_co2g&#39;])+&#39;\n&#39; </span>
			<span class="c1">#if &#39;S_co2l&#39; in keys: prntStr+=&#39;sat co2 liq = &#39;+str(self.variable[&#39;S_co2l&#39;])+&#39;\n&#39; </span>
			<span class="c1">#if &#39;co2aq&#39; in keys: prntStr+=&#39;dissolved co2 = &#39;+str(self.variable[&#39;co2aq&#39;])+&#39;\n&#39; </span>
			<span class="c1">#if &#39;eos&#39; in keys: prntStr+=&#39;water phase = &#39;+str(self.variable[&#39;eos&#39;])+&#39;\n&#39; </span>
			<span class="c1">#if &#39;co2_eos&#39; in keys: prntStr+=&#39;  co2 phase = &#39;+str(self.variable[&#39;co2_eos&#39;])+&#39;\n&#39; </span>
		<span class="c1">#if self.material:</span>
		<span class="n">prntStr</span><span class="o">+=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Material properties........</span><span class="se">\n</span><span class="s1">&#39;</span>
		<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">permeability</span><span class="p">,(</span><span class="nb">list</span><span class="p">,</span><span class="nb">tuple</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>
			<span class="n">prntStr</span> <span class="o">+=</span> <span class="s1">&#39;    kx = &#39;</span> <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">permeability</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
			<span class="n">prntStr</span> <span class="o">+=</span> <span class="s1">&#39;    ky = &#39;</span> <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">permeability</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
			<span class="n">prntStr</span> <span class="o">+=</span> <span class="s1">&#39;    kz = &#39;</span> <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">permeability</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
		<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">conductivity</span><span class="p">,(</span><span class="nb">list</span><span class="p">,</span><span class="nb">tuple</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>
			<span class="n">prntStr</span> <span class="o">+=</span> <span class="s1">&#39;    cond_x = &#39;</span> <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">conductivity</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
			<span class="n">prntStr</span> <span class="o">+=</span> <span class="s1">&#39;    cond_y = &#39;</span> <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">conductivity</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
			<span class="n">prntStr</span> <span class="o">+=</span> <span class="s1">&#39;    cond_z = &#39;</span> <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">conductivity</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">density</span><span class="p">:</span>
			<span class="n">prntStr</span> <span class="o">+=</span> <span class="s1">&#39;    density = &#39;</span> <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">density</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">specific_heat</span><span class="p">:</span>
			<span class="n">prntStr</span> <span class="o">+=</span> <span class="s1">&#39;    spec. heat = &#39;</span> <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">specific_heat</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">porosity</span><span class="p">:</span>
			<span class="n">prntStr</span> <span class="o">+=</span> <span class="s1">&#39;    porosity = &#39;</span> <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">porosity</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">youngs_modulus</span><span class="p">:</span>
			<span class="n">prntStr</span> <span class="o">+=</span> <span class="s1">&#39;    Youngs modulus = &#39;</span> <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">youngs_modulus</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">poissons_ratio</span><span class="p">:</span>
			<span class="n">prntStr</span> <span class="o">+=</span> <span class="s1">&#39;    Poissons ratio = &#39;</span> <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">poissons_ratio</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">thermal_expansion</span><span class="p">:</span>
			<span class="n">prntStr</span> <span class="o">+=</span> <span class="s1">&#39;    Thermal expansion = &#39;</span> <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">thermal_expansion</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pressure_coupling</span><span class="p">:</span>
			<span class="n">prntStr</span> <span class="o">+=</span> <span class="s1">&#39;    Pressure coupling = &#39;</span> <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pressure_coupling</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">generator</span><span class="p">:</span>
			<span class="n">prntStr</span><span class="o">+=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Generator properties.......</span><span class="se">\n</span><span class="s1">&#39;</span>
			<span class="n">ks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generator</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
			<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">ks</span><span class="p">:</span>
				<span class="n">prntStr</span> <span class="o">+=</span> <span class="s1">&#39;    &#39;</span><span class="o">+</span><span class="n">k</span> <span class="o">+</span> <span class="s1">&#39; = &#39;</span> <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">generator</span><span class="p">[</span><span class="n">k</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
		<span class="nb">print</span> <span class="n">prntStr</span>
	<span class="n">what</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_get_info</span><span class="p">)</span>							<span class="c1">#: Print to screen information about the node.</span>
	<span class="k">def</span> <span class="nf">_get_connected_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="n">ndlist</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="k">for</span> <span class="n">con</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">connections</span><span class="p">:</span>
			<span class="k">for</span> <span class="n">nd</span> <span class="ow">in</span> <span class="n">con</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span>
				<span class="k">if</span> <span class="n">nd</span> <span class="o">!=</span> <span class="bp">self</span><span class="p">:</span> <span class="n">ndlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nd</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">ndlist</span>
	<span class="n">connected_nodes</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_get_connected_nodes</span><span class="p">)</span>		<span class="c1">#: (*lst[fnode]*) List of node objects connected to this node. This information only available if full_connectivity=True passed to fgrid.read()</span>
	<span class="k">def</span> <span class="nf">_get_connections</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_connections</span>
	<span class="n">connections</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_get_connections</span><span class="p">)</span><span class="c1">#: (*lst[fconn]*) List of connection objects of which the node is a member.</span>
	<span class="k">def</span> <span class="nf">_get_elements</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_elements</span>
	<span class="n">elements</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_get_elements</span><span class="p">)</span><span class="c1">#: (*lst[felem]*) List of element objects of which the node is a member.</span>
	<span class="k">def</span> <span class="nf">_get_zonelist</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">zone</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">zone</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
	<span class="n">zonelist</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_get_zonelist</span><span class="p">)</span>	<span class="c1">#: (*lst[fzone]*) List of zones of which the node is a member</span>
	<span class="k">def</span> <span class="nf">_get_vol</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vol</span>
	<span class="n">vol</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_get_vol</span><span class="p">)</span>				<span class="c1">#: (*fl64*) Control volume associated with the node. This information only available if volumes() method called from grid attribute.</span>
	<span class="k">def</span> <span class="nf">_get_permeability</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_permeability</span>
	<span class="n">permeability</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_get_permeability</span><span class="p">)</span> <span class="c1">#: (*list*) permeability values at node.</span>
	<span class="k">def</span> <span class="nf">_get_conductivity</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_conductivity</span>
	<span class="n">conductivity</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_get_conductivity</span><span class="p">)</span> <span class="c1">#: (*list*) conductivity values at node.</span>
	<span class="k">def</span> <span class="nf">_get_density</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_density</span>
	<span class="n">density</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_get_density</span><span class="p">)</span> <span class="c1">#: (*fl64*) density at node.</span>
	<span class="k">def</span> <span class="nf">_get_specific_heat</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_specific_heat</span>
	<span class="n">specific_heat</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_get_specific_heat</span><span class="p">)</span> <span class="c1">#: (*fl64*) specific heat at node.</span>
	<span class="k">def</span> <span class="nf">_get_porosity</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_porosity</span>
	<span class="n">porosity</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_get_porosity</span><span class="p">)</span> <span class="c1">#: (*fl64*) porosity at node.</span>
	<span class="k">def</span> <span class="nf">_get_youngs_modulus</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_youngs_modulus</span>
	<span class="n">youngs_modulus</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_get_youngs_modulus</span><span class="p">)</span> <span class="c1">#: (*fl64*) Youngs modulus at node.</span>
	<span class="k">def</span> <span class="nf">_get_poissons_ratio</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_poissons_ratio</span>
	<span class="n">poissons_ratio</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_get_poissons_ratio</span><span class="p">)</span> <span class="c1">#: (*fl64*) Poissons ratio at node.</span>
	<span class="k">def</span> <span class="nf">_get_thermal_expansion</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_thermal_expansion</span>
	<span class="n">thermal_expansion</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_get_thermal_expansion</span><span class="p">)</span> <span class="c1">#: (*fl64*) Coefficient of thermal expansion at node.</span>
	<span class="k">def</span> <span class="nf">_get_pressure_coupling</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pressure_coupling</span>
	<span class="n">pressure_coupling</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_get_pressure_coupling</span><span class="p">)</span> <span class="c1">#: (*fl64*) Biot pressure coupling coefficient at node.</span>
	<span class="k">def</span> <span class="nf">_get_Pi</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Pi</span>
	<span class="n">Pi</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_get_Pi</span><span class="p">)</span> <span class="c1">#: (*fl64*) initial pressure at node.</span>
	<span class="k">def</span> <span class="nf">_get_Ti</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Ti</span>
	<span class="n">Ti</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_get_Ti</span><span class="p">)</span> <span class="c1">#: (*fl64*) initial temperature at node.</span>
	<span class="k">def</span> <span class="nf">_get_Si</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Si</span>
	<span class="n">Si</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_get_Si</span><span class="p">)</span> <span class="c1">#: (*fl64*) initial water saturation at node.</span>
	<span class="k">def</span> <span class="nf">_get_S_co2gi</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_S_co2gi</span>
	<span class="n">S_co2gi</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_get_S_co2gi</span><span class="p">)</span> <span class="c1">#: (*fl64*) initial gaseous CO2 saturation at node.</span>
	<span class="k">def</span> <span class="nf">_get_S_co2li</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_S_co2li</span>
	<span class="n">S_co2li</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_get_S_co2li</span><span class="p">)</span> <span class="c1">#: (*fl64*) initial liquid CO2 saturation at node.</span>
	<span class="k">def</span> <span class="nf">_get_co2aqi</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_co2aqi</span>
	<span class="n">co2aqi</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_get_co2aqi</span><span class="p">)</span> <span class="c1">#: (*fl64*) initial dissolved CO2 concentration at node.</span>
	<span class="k">def</span> <span class="nf">_get_strsi</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_strsi</span>
	<span class="n">strsi</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_get_strsi</span><span class="p">)</span> <span class="c1">#: (*fl64*) initial stresses at node.</span>
	<span class="k">def</span> <span class="nf">_get_dispi</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dispi</span>
	<span class="n">dispi</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_get_dispi</span><span class="p">)</span> <span class="c1">#: (*fl64*) initial displacements at node.</span>
	<span class="k">def</span> <span class="nf">_get_P</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_P</span>
	<span class="n">P</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_get_P</span><span class="p">)</span> <span class="c1">#: (*fl64*) pressure at node during a simulation.</span>
	<span class="k">def</span> <span class="nf">_get_T</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_T</span>
	<span class="n">T</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_get_T</span><span class="p">)</span> <span class="c1">#: (*fl64*) temperature at node.</span>
	<span class="k">def</span> <span class="nf">_get_S</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_S</span>
	<span class="n">S</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_get_S</span><span class="p">)</span> <span class="c1">#: (*fl64*) water saturation at node.</span>
	<span class="k">def</span> <span class="nf">_get_S_co2g</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_S_co2g</span>
	<span class="n">S_co2g</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_get_S_co2g</span><span class="p">)</span> <span class="c1">#: (*fl64*) gaseous CO2 saturation at node.</span>
	<span class="k">def</span> <span class="nf">_get_S_co2l</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_S_co2l</span>
	<span class="n">S_co2l</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_get_S_co2l</span><span class="p">)</span> <span class="c1">#: (*fl64*) liquid CO2 saturation at node.</span>
	<span class="k">def</span> <span class="nf">_get_co2aq</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_co2aq</span>
	<span class="n">co2aq</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_get_co2aq</span><span class="p">)</span> <span class="c1">#: (*fl64*) dissolved CO2 concentration at node.</span>
	<span class="k">def</span> <span class="nf">_get_strs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_strs</span>
	<span class="n">strs</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_get_strs</span><span class="p">)</span> <span class="c1">#: (*list*) stresses at node ([xx,yy,xy] for 2D, [xx,yy,zz,xy,yz,xz] for 3D).</span>
	<span class="k">def</span> <span class="nf">_get_disp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_disp</span>
	<span class="n">disp</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_get_disp</span><span class="p">)</span> <span class="c1">#: (*list*) displacements at node ([x,y] for 2D, [x,y,z] for 3D).</span>
	<span class="k">def</span> <span class="nf">_get_rlpmodel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rlpmodel</span>
	<span class="n">rlpmodel</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_get_rlpmodel</span><span class="p">)</span> <span class="c1">#: (*int*) index of relative permeability model assigned to node</span>
	<span class="k">def</span> <span class="nf">_get_permmodel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_permmodel</span>
	<span class="n">permmodel</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_get_permmodel</span><span class="p">)</span> <span class="c1">#: (*int*) index of stress-permeability model assigned to node.</span>
	<span class="k">def</span> <span class="nf">_get_pormodel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pormodel</span>
	<span class="n">pormodel</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_get_pormodel</span><span class="p">)</span> <span class="c1">#: (*int*) index of variable porosity model assigned to node.</span>
	<span class="k">def</span> <span class="nf">_get_condmodel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_condmodel</span>
	<span class="n">condmodel</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_get_condmodel</span><span class="p">)</span> <span class="c1">#: (*int*) index of variable conductivity model assigned to node.</span></div>
<div class="viewcode-block" id="fconn"><a class="viewcode-back" href="../fgrid.html#fgrid.fconn">[docs]</a><span class="k">class</span> <span class="nc">fconn</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>				<span class="c1">#Connection object.</span>
	<span class="sd">&quot;&quot;&quot;Connection object, comprising two connected nodes, separated by some distance.</span>

<span class="sd">	A connection is associated with a distance between the two nodes.</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">nodes</span><span class="o">=</span><span class="p">[</span><span class="n">fnode</span><span class="p">(),</span><span class="n">fnode</span><span class="p">()]):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_nodes</span> <span class="o">=</span> <span class="n">nodes</span>		
		<span class="n">pos1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">position</span><span class="p">;</span> <span class="n">pos2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">position</span>
		<span class="k">if</span> <span class="n">pos1</span> <span class="o">==</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">pos2</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_distance</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="k">else</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_distance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">pos1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">pos2</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="p">(</span><span class="n">pos1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">pos2</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="p">(</span><span class="n">pos1</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="n">pos2</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_geom_coef</span> <span class="o">=</span> <span class="kc">None</span>
	<span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>	<span class="k">return</span> <span class="s1">&#39;n&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;:n&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>	
	<span class="k">def</span> <span class="nf">_get_distance</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_distance</span>
	<span class="n">distance</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_get_distance</span><span class="p">)</span>	<span class="c1">#: (*fl64*) Distance between the two connected nodes.</span>
	<span class="k">def</span> <span class="nf">_get_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nodes</span>
	<span class="n">nodes</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_get_nodes</span><span class="p">)</span><span class="c1">#: (*lst[fnode]*) List of node objects (fnode()) that define the connection.</span>
	<span class="k">def</span> <span class="nf">_get_geom_coef</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_geom_coef</span>
	<span class="n">geom_coef</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_get_geom_coef</span><span class="p">)</span><span class="c1">#: (*fl64*) Geometric coefficient associated with the connection (connected area divided by distance).</span></div>
<div class="viewcode-block" id="felem"><a class="viewcode-back" href="../fgrid.html#fgrid.felem">[docs]</a><span class="k">class</span> <span class="nc">felem</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>				<span class="c1">#Element object.</span>
	<span class="sd">&quot;&quot;&quot;Finite element object, comprising a set of connected nodes.</span>
<span class="sd">	</span>
<span class="sd">	A finite element is associated with an element centre and an element volume.</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">nodes</span> <span class="o">=</span> <span class="p">[]):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_index</span> <span class="o">=</span> <span class="n">index</span>			
		<span class="bp">self</span><span class="o">.</span><span class="n">_nodes</span> <span class="o">=</span> <span class="n">nodes</span>			
	<span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> 
		<span class="n">retStr</span> <span class="o">=</span> <span class="s1">&#39;el&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;: &#39;</span>
		<span class="k">for</span> <span class="n">nd</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span> <span class="n">retStr</span><span class="o">+=</span><span class="s1">&#39;nd&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">nd</span><span class="o">.</span><span class="n">index</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;, &#39;</span>
		<span class="k">return</span> <span class="n">retStr</span>
	<span class="k">def</span> <span class="nf">_get_index</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index</span>
	<span class="n">index</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_get_index</span><span class="p">)</span><span class="c1">#: (*int*) Integer number denoting the element.		</span>
	<span class="k">def</span> <span class="nf">_get_centre</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
		<span class="k">for</span> <span class="n">nd</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span> <span class="n">c</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">nd</span><span class="o">.</span><span class="n">position</span><span class="p">)</span>
		<span class="n">c</span> <span class="o">=</span> <span class="n">c</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">c</span>
	<span class="n">centre</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_get_centre</span><span class="p">)</span>	<span class="c1">#: (*ndarray*) Coordinates of the element centroid.</span>
	<span class="k">def</span> <span class="nf">get_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="nb">print</span> <span class="s1">&#39;Element number: &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
		<span class="nb">print</span> <span class="s1">&#39;      Centroid: &#39;</span>
		<span class="nb">print</span> <span class="s1">&#39;            x = &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">centre</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
		<span class="nb">print</span> <span class="s1">&#39;            y = &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">centre</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
		<span class="nb">print</span> <span class="s1">&#39;            z = &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">centre</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
		<span class="n">prntStr</span> <span class="o">=</span>  <span class="s1">&#39;Contains nodes: [&#39;</span>
		<span class="k">for</span> <span class="n">nd</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span> <span class="n">prntStr</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">nd</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="o">+</span><span class="s1">&#39;,&#39;</span>
		<span class="n">prntStr</span> <span class="o">=</span> <span class="n">prntStr</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;]&#39;</span>
		<span class="nb">print</span> <span class="n">prntStr</span>
	<span class="n">what</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">get_info</span><span class="p">)</span>				<span class="c1">#: Print to screen information about the element.</span>
	<span class="k">def</span> <span class="nf">_get_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nodes</span>
	<span class="n">nodes</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_get_nodes</span><span class="p">)</span><span class="c1">#: (*lst[fnode]*) List of node objects that define the element.		</span>
	<span class="k">def</span> <span class="nf">_get_volume</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="kc">None</span>
	<span class="n">vol</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_get_volume</span><span class="p">)</span>		<span class="c1">#: (*fl64*) Volume of the element *** NOT DONE ***.		</span></div>
<span class="k">class</span> <span class="nc">octree</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>				<span class="c1">#Octree object.</span>
	<span class="sd">&quot;&quot;&quot;Octree for spatial searching in 3D grids.</span>
<span class="sd">	</span>
<span class="sd">	The octree is automatically constructed when a new grid file is parsed.</span>
<span class="sd">	</span>
<span class="sd">	Note: direct interaction with this method is not generally required (or advised!).</span>
<span class="sd">	</span>
<span class="sd">	The octree is generated recursively, by sub-dividing the model domain into smaller and smaller compartments.</span>
<span class="sd">	If a compartment contains more than one point then it continues to sub-divide until there is no more than one point</span>
<span class="sd">	per compartment.</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">bounds</span><span class="p">,</span><span class="n">elements</span><span class="p">,</span><span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">repair</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">=</span><span class="n">parent</span>		<span class="c1">#: Parent compartment to which the compartment belongs.</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">bounds</span><span class="o">=</span><span class="n">bounds</span>		<span class="c1">#: Bounding box defining the compartment.</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="o">=</span><span class="n">elements</span>	<span class="c1">#: (*fnode*) Objects contained in the compartment.</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">child</span><span class="o">=</span><span class="p">[]</span> 			<span class="c1">#: Children compartments contained within the compartment.</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">neighbour</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">]</span>	<span class="c1">#: Six element list containing, in order, compartments +x, -x, +y, -y, +z, -z</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">:</span> 		<span class="c1"># if has a parent, is a child, iterate generation, inherit all elements</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">generation</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">generation</span><span class="o">+</span><span class="mi">1</span>	<span class="c1">#: Generation of the compartment (a measure of how many sub-divisions have occurred.)</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">all_elements</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">all_elements</span>
		<span class="k">else</span><span class="p">:</span> 					<span class="c1"># if not a parent, generation 0, elements only those existing</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">generation</span><span class="o">=</span><span class="mi">0</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">all_elements</span><span class="o">=</span><span class="nb">set</span><span class="p">(</span><span class="n">elements</span><span class="p">)</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">generation</span><span class="o">&gt;</span><span class="mi">50</span><span class="p">:</span>
			<span class="k">if</span> <span class="ow">not</span> <span class="n">repair</span><span class="p">:</span>
				<span class="n">pos0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">position</span>
				<span class="n">multipleFlag</span> <span class="o">=</span> <span class="kc">False</span>
				<span class="k">for</span> <span class="n">elt</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
					<span class="n">pos</span> <span class="o">=</span> <span class="n">elt</span><span class="o">.</span><span class="n">position</span>
					<span class="n">dist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pos0</span><span class="p">)</span>
					<span class="n">dist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">dist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">dist</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">dist</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
					<span class="k">if</span> <span class="n">dist</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="n">multipleFlag</span> <span class="o">=</span> <span class="kc">True</span><span class="p">;</span> <span class="k">break</span>
				<span class="k">if</span> <span class="n">multipleFlag</span><span class="p">:</span>
					<span class="nb">print</span> <span class="s1">&#39;ERROR: multiple nodes specified at same location. See below for details.&#39;</span>
					<span class="n">elt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
					<span class="nb">print</span> <span class="s1">&#39;&#39;</span>
					<span class="nb">print</span> <span class="s1">&#39;Node &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">elt</span><span class="o">.</span><span class="n">index</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;: &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">elt</span><span class="o">.</span><span class="n">position</span><span class="p">)</span>
					<span class="k">for</span> <span class="n">elt</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
						<span class="n">pos</span> <span class="o">=</span> <span class="n">elt</span><span class="o">.</span><span class="n">position</span>
						<span class="n">dist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pos0</span><span class="p">)</span>
						<span class="n">dist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">dist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">dist</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">dist</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
						<span class="k">if</span> <span class="n">dist</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> 
							<span class="nb">print</span> <span class="s1">&#39;Node &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">elt</span><span class="o">.</span><span class="n">index</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;: &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">elt</span><span class="o">.</span><span class="n">position</span><span class="p">)</span>
					<span class="nb">print</span> <span class="s1">&#39;&#39;</span>
					<span class="nb">print</span> <span class="s1">&#39;Run repair_grid() to attempt fix.&#39;</span>
					<span class="k">return</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">pos0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">position</span>
				<span class="n">multipleFlag</span> <span class="o">=</span> <span class="kc">False</span>
				<span class="k">for</span> <span class="n">elt</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
					<span class="n">pos</span> <span class="o">=</span> <span class="n">elt</span><span class="o">.</span><span class="n">position</span>
					<span class="n">dist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pos0</span><span class="p">)</span>
					<span class="n">dist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">dist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">dist</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">dist</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
					<span class="k">if</span> <span class="n">dist</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="n">multipleFlag</span> <span class="o">=</span> <span class="kc">True</span><span class="p">;</span> <span class="k">break</span>
				<span class="k">if</span> <span class="n">multipleFlag</span><span class="p">:</span>
					<span class="n">nds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">elements</span>
					<span class="c1"># find node with minimum index - this takes priority</span>
					<span class="n">nd1</span> <span class="o">=</span> <span class="n">nds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
					<span class="k">for</span> <span class="n">nd2</span> <span class="ow">in</span> <span class="n">nds</span><span class="p">:</span>
						<span class="k">if</span> <span class="n">nd2</span><span class="o">.</span><span class="n">index</span> <span class="o">&lt;</span> <span class="n">nd1</span><span class="o">.</span><span class="n">index</span><span class="p">:</span> <span class="n">nd1</span> <span class="o">=</span> <span class="n">nd2</span>
					<span class="n">nds</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">nd1</span><span class="p">)</span>
					<span class="c1"># for all other nodes, clean from parent grid</span>
					<span class="n">nd1</span> <span class="o">=</span> <span class="n">repair</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">nd1</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>					
					<span class="k">for</span> <span class="n">nd2</span> <span class="ow">in</span> <span class="n">nds</span><span class="p">:</span>
						<span class="n">nd2</span> <span class="o">=</span> <span class="n">repair</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">nd2</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>
						<span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">nd2</span><span class="o">.</span><span class="n">_elements</span><span class="p">:</span>
							<span class="n">el</span><span class="o">.</span><span class="n">_nodes</span> <span class="o">=</span> <span class="p">[</span><span class="n">nd1</span> <span class="k">if</span> <span class="n">nd</span><span class="o">.</span><span class="n">index</span> <span class="o">==</span> <span class="n">nd2</span><span class="o">.</span><span class="n">index</span> <span class="k">else</span> <span class="n">nd</span> <span class="k">for</span> <span class="n">nd</span> <span class="ow">in</span> <span class="n">el</span><span class="o">.</span><span class="n">_nodes</span><span class="p">]</span>
							
						<span class="c1"># remove node from nodelist</span>
						<span class="n">ind</span> <span class="o">=</span> <span class="n">repair</span><span class="o">.</span><span class="n">_nodelist</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">nd2</span><span class="p">)</span>
						<span class="n">repair</span><span class="o">.</span><span class="n">_nodelist</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">nd2</span><span class="p">)</span>
							
						<span class="nb">print</span> <span class="s1">&#39;  &#39;</span><span class="p">,</span><span class="n">nd2</span><span class="p">,</span><span class="s1">&#39; duplicated &#39;</span><span class="p">,</span><span class="n">nd1</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">elements</span> <span class="o">=</span> <span class="p">[</span><span class="n">nd1</span><span class="p">]</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_elements</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span> 	<span class="c1"># if more than one element in a cube, sub-divide</span>
			<span class="n">cubes</span><span class="o">=</span><span class="n">sub_cubes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bounds</span><span class="p">)</span>
			<span class="c1"># update neighbour locations</span>
			<span class="n">cube_elements</span><span class="o">=</span><span class="p">[[],[],[],[],[],[],[],[]]</span>
			<span class="k">for</span> <span class="n">elt</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="p">:</span>
				<span class="k">for</span> <span class="n">icube</span><span class="p">,</span><span class="n">cube</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">cubes</span><span class="p">):</span>
					<span class="k">if</span> <span class="n">in_cube</span><span class="p">(</span><span class="n">elt</span><span class="o">.</span><span class="n">position</span><span class="p">,</span><span class="n">cube</span><span class="p">):</span>
						<span class="n">cube_elements</span><span class="p">[</span><span class="n">icube</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">elt</span><span class="p">)</span>
						<span class="k">break</span>
			<span class="n">nbrs</span><span class="o">=</span><span class="p">[]</span>
			<span class="k">for</span> <span class="n">cube</span><span class="p">,</span><span class="n">elts</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">cubes</span><span class="p">,</span><span class="n">cube_elements</span><span class="p">):</span>
				<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">elts</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span> 
					<span class="k">if</span> <span class="n">repair</span><span class="p">:</span>
						<span class="bp">self</span><span class="o">.</span><span class="n">child</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">octree</span><span class="p">(</span><span class="n">cube</span><span class="p">,</span><span class="n">elts</span><span class="p">,</span><span class="bp">self</span><span class="p">,</span><span class="n">repair</span><span class="p">))</span>
					<span class="k">else</span><span class="p">:</span>
						<span class="bp">self</span><span class="o">.</span><span class="n">child</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">octree</span><span class="p">(</span><span class="n">cube</span><span class="p">,</span><span class="n">elts</span><span class="p">,</span><span class="bp">self</span><span class="p">))</span>
					<span class="n">nbrs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
				<span class="k">else</span><span class="p">:</span> <span class="n">nbrs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">assign_neighbours</span><span class="p">(</span><span class="n">nbrs</span><span class="p">)</span>
	<span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">()</span>
	<span class="k">def</span> <span class="nf">assign_neighbours</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">neighbours</span><span class="p">):</span>
		<span class="n">cube_inds</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="k">for</span> <span class="n">cube_ind</span><span class="p">,</span><span class="n">exist</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">neighbours</span><span class="p">):</span>
			<span class="k">if</span> <span class="n">exist</span><span class="p">:</span> <span class="n">cube_inds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cube_ind</span><span class="p">)</span>
		<span class="k">for</span> <span class="n">child</span><span class="p">,</span><span class="n">update</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">child</span><span class="p">,</span><span class="n">cube_inds</span><span class="p">):</span>
			<span class="n">child</span><span class="o">.</span><span class="n">neighbour</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">neighbour</span><span class="p">)</span>
			<span class="n">posI</span><span class="p">,</span><span class="n">nbrs</span> <span class="o">=</span> <span class="n">nbr_update</span><span class="p">[</span><span class="n">update</span><span class="p">]</span>
			<span class="k">for</span> <span class="n">pos</span><span class="p">,</span><span class="n">nbr</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">posI</span><span class="p">,</span><span class="n">nbrs</span><span class="p">):</span>
				<span class="k">if</span> <span class="n">nbr</span> <span class="ow">in</span> <span class="n">cube_inds</span><span class="p">:</span>
					<span class="n">child</span><span class="o">.</span><span class="n">neighbour</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">child</span><span class="p">[</span><span class="n">cube_inds</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">nbr</span><span class="p">)]</span>
			
	<span class="k">def</span> <span class="nf">get_num_elements</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="p">)</span>
	<span class="n">num_elements</span><span class="o">=</span><span class="nb">property</span><span class="p">(</span><span class="n">get_num_elements</span><span class="p">)</span>	<span class="c1">#: (*int*) Number of objects in the compartment.</span>
	<span class="k">def</span> <span class="nf">get_num_children</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">child</span><span class="p">)</span>
	<span class="n">num_children</span><span class="o">=</span><span class="nb">property</span><span class="p">(</span><span class="n">get_num_children</span><span class="p">)</span> <span class="c1">#: (*int*) Number of sub-compartments in the compartment.</span>
	<span class="k">def</span> <span class="nf">leaf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">pos</span><span class="p">):</span> 							<span class="c1"># find leaf corresponding to position</span>
		<span class="k">if</span> <span class="n">in_cube</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">bounds</span><span class="p">):</span>
			<span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">child</span><span class="p">:</span>
				<span class="n">childleaf</span><span class="o">=</span><span class="n">child</span><span class="o">.</span><span class="n">leaf</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>
				<span class="k">if</span> <span class="n">childleaf</span><span class="p">:</span> <span class="k">return</span> <span class="n">childleaf</span>
			<span class="k">return</span> <span class="bp">self</span>
		<span class="k">else</span><span class="p">:</span> <span class="k">return</span> <span class="kc">None</span>
	<span class="k">def</span> <span class="nf">min_dist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">pos</span><span class="p">):</span>
		<span class="n">min_dist</span> <span class="o">=</span> <span class="mf">1.e10</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">child</span><span class="p">:</span>
			<span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">child</span><span class="p">:</span>
				<span class="n">dist</span><span class="p">,</span><span class="n">cube</span> <span class="o">=</span> <span class="n">child</span><span class="o">.</span><span class="n">min_dist</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>
				<span class="k">if</span> <span class="n">dist</span><span class="o">&lt;</span><span class="n">min_dist</span><span class="p">:</span> <span class="n">min_dist</span> <span class="o">=</span> <span class="n">dist</span><span class="p">;</span> <span class="n">min_cube</span> <span class="o">=</span> <span class="n">cube</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">min_dist</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span>
				<span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">pos</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span>
				<span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="n">pos</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
			<span class="n">min_cube</span> <span class="o">=</span> <span class="bp">self</span>
		<span class="c1">#print min_cube.elements[0].index, &#39; &#39;, min_dist</span>
		<span class="k">return</span> <span class="n">min_dist</span><span class="p">,</span><span class="n">min_cube</span>
<div class="viewcode-block" id="fgrid"><a class="viewcode-back" href="../fgrid.html#fgrid.fgrid">[docs]</a><span class="k">class</span> <span class="nc">fgrid</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>				<span class="c1">#Grid object.</span>
	<span class="sd">&quot;&quot;&quot; FEHM grid object.</span>
<span class="sd">	</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">full_connectivity</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_nodelist</span><span class="o">=</span><span class="p">[]</span>			
		<span class="bp">self</span><span class="o">.</span><span class="n">_node</span><span class="o">=</span><span class="p">{}</span>				
		<span class="bp">self</span><span class="o">.</span><span class="n">_connlist</span><span class="o">=</span><span class="p">[]</span>			
		<span class="bp">self</span><span class="o">.</span><span class="n">_conn</span><span class="o">=</span><span class="p">{}</span>				
		<span class="bp">self</span><span class="o">.</span><span class="n">_elemlist</span><span class="o">=</span><span class="p">[]</span>			
		<span class="bp">self</span><span class="o">.</span><span class="n">_elem</span><span class="o">=</span><span class="p">{}</span>				
		<span class="bp">self</span><span class="o">.</span><span class="n">_octree</span><span class="o">=</span><span class="kc">None</span>			
		<span class="bp">self</span><span class="o">.</span><span class="n">_dimensions</span><span class="o">=</span><span class="mi">3</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_parent</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_full_connectivity</span> <span class="o">=</span> <span class="n">full_connectivity</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_path</span> <span class="o">=</span> <span class="n">fpath</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>		
		<span class="bp">self</span><span class="o">.</span><span class="n">_pos_matrix</span> <span class="o">=</span> <span class="kc">None</span>
	<span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> 
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
			<span class="k">return</span> <span class="s1">&#39;no grid&#39;</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span>			<span class="c1">#Print out details</span>
<div class="viewcode-block" id="fgrid.read"><a class="viewcode-back" href="../fgrid.html#fgrid.fgrid.read">[docs]</a>	<span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">gridfilename</span><span class="p">,</span><span class="n">full_connectivity</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">octree</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span> 
		<span class="sd">&quot;&quot;&quot;Read data from an FEHM or AVS grid file. If an AVS grid is specified, PyFEHM will write out the corresponding FEHM grid file.</span>

<span class="sd">		:param gridfilename: name of grid file, including path specification.</span>
<span class="sd">		:type gridfilename: str</span>
<span class="sd">		:param full_connectivity: read element and connection data and construct corresponding objects. Defaults to False. Use if access to connectivity information will be useful.</span>
<span class="sd">		:type full_connectivity: bool</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_full_connectivity</span> <span class="o">=</span> <span class="n">full_connectivity</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">gridfilename</span> 
		<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">gridfilename</span><span class="p">):</span>
			<span class="nb">print</span> <span class="s1">&#39;ERROR: file at &#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="o">.</span><span class="n">full_path</span><span class="o">+</span><span class="s1">&#39; not found.&#39;</span><span class="p">;</span> <span class="k">return</span>
		<span class="c1"># assess format of file	from first two lines</span>
		<span class="n">infile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="o">.</span><span class="n">full_path</span><span class="p">)</span>
		<span class="n">ln1</span> <span class="o">=</span> <span class="n">infile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
		<span class="n">ln2</span> <span class="o">=</span> <span class="n">infile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
		<span class="n">infile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
		<span class="n">isAvs</span> <span class="o">=</span> <span class="kc">False</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="n">a</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">ln2</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span> 	<span class="c1"># first number of second line is a 1, five numbers in header</span>
			<span class="k">if</span> <span class="n">a</span>  <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">ln1</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">())</span><span class="o">==</span><span class="mi">5</span><span class="p">:</span> <span class="n">isAvs</span> <span class="o">=</span> <span class="kc">True</span>
		<span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span> <span class="k">pass</span>
		<span class="k">if</span> <span class="n">gridfilename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.stor&#39;</span><span class="p">):</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">read_stor</span><span class="p">()</span>
			<span class="k">return</span>
		<span class="k">elif</span> <span class="n">ln1</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;coor&#39;</span><span class="p">):</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">_read_fehm</span><span class="p">()</span> 	<span class="c1"># first line starts with &#39;coor&#39;</span>
		<span class="k">elif</span> <span class="n">isAvs</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">_read_avs</span><span class="p">()</span>		
			<span class="n">newgridfilename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="o">.</span><span class="n">full_path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
			<span class="n">newgridfilename</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">newgridfilename</span><span class="p">,</span><span class="s1">&#39;.&#39;</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;.inp&#39;</span>
			<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">newgridfilename</span><span class="p">):</span>
				<span class="n">newgridfilename</span> <span class="o">=</span> <span class="n">newgridfilename</span><span class="p">[:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;_new&#39;</span> <span class="o">+</span> <span class="n">newgridfilename</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">:]</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">newgridfilename</span><span class="p">,</span> <span class="s1">&#39;fehm&#39;</span><span class="p">)</span>		<span class="c1"># write out equivalent fehm grid</span>
			<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">files</span><span class="o">.</span><span class="n">grid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="o">.</span><span class="n">filename</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="nb">print</span> <span class="s1">&#39;ERROR: Unrecognized grid format.&#39;</span>
			
		<span class="k">if</span> <span class="n">octree</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_nodetree</span><span class="p">()</span>
		<span class="k">else</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pos_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">nd</span><span class="o">.</span><span class="n">position</span> <span class="k">for</span> <span class="n">nd</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodelist</span><span class="p">])</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">_add_boundary_zones</span><span class="p">()</span></div>
	<span class="k">def</span> <span class="nf">_read_fehm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> 		<span class="c1">#Read in fehm meshfile for node,element data .</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_nodelist</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_connlist</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_elemlist</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="n">infile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="o">.</span><span class="n">full_path</span><span class="p">)</span>
		
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">files</span><span class="o">.</span><span class="n">grid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="o">.</span><span class="n">filename</span>
			
		<span class="n">ln</span> <span class="o">=</span> <span class="n">infile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
		<span class="n">N</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">infile</span><span class="o">.</span><span class="n">readline</span><span class="p">())</span>
		<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
			<span class="n">nd</span> <span class="o">=</span> <span class="n">infile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
			<span class="n">new_node</span> <span class="o">=</span> <span class="n">fnode</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">nd</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="n">position</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">nd</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span><span class="nb">float</span><span class="p">(</span><span class="n">nd</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span><span class="nb">float</span><span class="p">(</span><span class="n">nd</span><span class="p">[</span><span class="mi">3</span><span class="p">])]))</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">new_node</span><span class="p">)</span>	
		
		<span class="n">infile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
		<span class="n">infile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
		<span class="n">N</span> <span class="o">=</span> <span class="n">infile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
		<span class="n">connectivity</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">N</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
		<span class="n">N</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">N</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">])</span>
		<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
			<span class="n">el</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">eli</span><span class="p">)</span> <span class="k">for</span> <span class="n">eli</span> <span class="ow">in</span> <span class="n">infile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()]</span>
			
			<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_full_connectivity</span><span class="p">:</span>
				<span class="n">new_elem</span> <span class="o">=</span> <span class="n">felem</span><span class="p">(</span><span class="n">index</span> <span class="o">=</span> <span class="n">el</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">nodes</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">eli</span><span class="p">]</span> <span class="k">for</span> <span class="n">eli</span> <span class="ow">in</span> <span class="n">el</span><span class="p">[</span><span class="mi">1</span><span class="p">:]])</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">add_elem</span><span class="p">(</span><span class="n">new_elem</span><span class="p">)</span>
				<span class="k">if</span> <span class="n">connectivity</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span>
					<span class="n">nds1</span> <span class="o">=</span> <span class="p">[</span><span class="n">el</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">el</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">el</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">el</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span><span class="n">el</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span><span class="n">el</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span><span class="n">el</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span><span class="n">el</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span><span class="n">el</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span><span class="n">el</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span><span class="n">el</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">el</span><span class="p">[</span><span class="mi">5</span><span class="p">]]</span>
					<span class="n">nds2</span> <span class="o">=</span> <span class="p">[</span><span class="n">el</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span><span class="n">el</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">el</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span><span class="n">el</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span><span class="n">el</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span><span class="n">el</span><span class="p">[</span><span class="mi">8</span><span class="p">],</span><span class="n">el</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span><span class="n">el</span><span class="p">[</span><span class="mi">8</span><span class="p">],</span><span class="n">el</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span><span class="n">el</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">el</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span><span class="n">el</span><span class="p">[</span><span class="mi">8</span><span class="p">]]</span>
				<span class="k">elif</span> <span class="n">connectivity</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
					<span class="n">nds1</span> <span class="o">=</span> <span class="p">[</span><span class="n">el</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">el</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">el</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span><span class="n">el</span><span class="p">[</span><span class="mi">4</span><span class="p">]]</span>
					<span class="n">nds2</span> <span class="o">=</span> <span class="p">[</span><span class="n">el</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">el</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span><span class="n">el</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span><span class="n">el</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
				<span class="k">elif</span> <span class="n">connectivity</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
					<span class="n">nds1</span> <span class="o">=</span> <span class="p">[</span><span class="n">el</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">el</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">el</span><span class="p">[</span><span class="mi">3</span><span class="p">]]</span>
					<span class="n">nds2</span> <span class="o">=</span> <span class="p">[</span><span class="n">el</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">el</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span><span class="n">el</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
				<span class="k">else</span><span class="p">:</span>
					<span class="nb">print</span> <span class="s1">&#39;ERROR: unrecognized connectivity&#39;</span><span class="p">;</span> <span class="k">return</span>
				<span class="k">for</span> <span class="n">nd1</span><span class="p">,</span><span class="n">nd2</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">nds1</span><span class="p">,</span><span class="n">nds2</span><span class="p">):</span>
					<span class="k">if</span> <span class="n">nd1</span><span class="o">&gt;</span><span class="n">nd2</span><span class="p">:</span> <span class="n">ndi</span> <span class="o">=</span> <span class="n">nd2</span><span class="p">;</span> <span class="n">nd2</span> <span class="o">=</span> <span class="n">nd1</span><span class="p">;</span> <span class="n">nd1</span> <span class="o">=</span> <span class="n">ndi</span>
					<span class="n">nd1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">nd1</span><span class="p">];</span> <span class="n">nd2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">nd2</span><span class="p">]</span>
					<span class="n">new_conn</span> <span class="o">=</span> <span class="n">fconn</span><span class="p">(</span><span class="n">nodes</span> <span class="o">=</span> <span class="p">[</span><span class="n">nd1</span><span class="p">,</span><span class="n">nd2</span><span class="p">])</span>
					
					<span class="n">nd1inds</span> <span class="o">=</span> <span class="p">[]</span>
					<span class="k">for</span> <span class="n">con</span> <span class="ow">in</span> <span class="n">nd1</span><span class="o">.</span><span class="n">connections</span><span class="p">:</span>
						<span class="k">for</span> <span class="n">nd</span> <span class="ow">in</span> <span class="n">con</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span> <span class="n">nd1inds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nd</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
					
					<span class="k">if</span> <span class="n">nd2</span><span class="o">.</span><span class="n">index</span> <span class="ow">in</span> <span class="n">nd1inds</span><span class="p">:</span> <span class="k">continue</span>
					
					<span class="bp">self</span><span class="o">.</span><span class="n">add_conn</span><span class="p">(</span><span class="n">new_conn</span><span class="p">)</span>
					<span class="n">nd1</span><span class="o">.</span><span class="n">connections</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_conn</span><span class="p">)</span>
					<span class="n">nd2</span><span class="o">.</span><span class="n">connections</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_conn</span><span class="p">)</span>
				<span class="c1"># associate element nodes with element</span>
				<span class="k">for</span> <span class="n">nd</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">elemlist</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span> 
					<span class="bp">self</span><span class="o">.</span><span class="n">_node</span><span class="p">[</span><span class="n">nd</span><span class="o">.</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">elemlist</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>		
			<span class="k">else</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">_elemlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">el</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">_elem</span><span class="p">[</span><span class="n">el</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">elemlist</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
		<span class="n">infile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>		
		<span class="k">if</span> <span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">([</span><span class="n">nd</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">nd</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodelist</span><span class="p">]))</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">or</span>
			 <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">([</span><span class="n">nd</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">nd</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodelist</span><span class="p">]))</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">or</span>
			 <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">([</span><span class="n">nd</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">nd</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodelist</span><span class="p">]))</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)):</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">_dimensions</span> <span class="o">=</span> <span class="mi">2</span>
		<span class="k">else</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dimensions</span> <span class="o">=</span> <span class="mi">3</span>
	<span class="k">def</span> <span class="nf">_read_avs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> 		<span class="c1">#Read in avs meshfile for node, element data.</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_nodelist</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_connlist</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_elemlist</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="n">infile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="o">.</span><span class="n">full_path</span><span class="p">)</span>
		
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">files</span><span class="o">.</span><span class="n">grid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="o">.</span><span class="n">filename</span>
			
		<span class="n">ln</span> <span class="o">=</span> <span class="n">infile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
		<span class="n">N</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">ln</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span> 			<span class="c1"># number nodes</span>
		<span class="n">N_el</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">ln</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">])</span>		<span class="c1"># number elements</span>
		<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span> 						<span class="c1"># FOR each node</span>
			<span class="n">nd</span> <span class="o">=</span> <span class="n">infile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>	<span class="c1"># read line</span>
			<span class="n">new_node</span> <span class="o">=</span> <span class="n">fnode</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">nd</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="n">position</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">nd</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span><span class="nb">float</span><span class="p">(</span><span class="n">nd</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span><span class="nb">float</span><span class="p">(</span><span class="n">nd</span><span class="p">[</span><span class="mi">3</span><span class="p">])]))</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">new_node</span><span class="p">)</span>	 				<span class="c1"># add node object</span>
		
		<span class="n">N</span> <span class="o">=</span> <span class="n">N_el</span>
		<span class="n">connectivity</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span> 						<span class="c1"># FOR each element</span>
			<span class="n">el</span> <span class="o">=</span> <span class="n">infile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
			<span class="n">el</span> <span class="o">=</span> <span class="p">[</span><span class="n">el</span><span class="p">[</span><span class="mi">0</span><span class="p">],]</span> <span class="o">+</span> <span class="n">el</span><span class="p">[</span><span class="mi">3</span><span class="p">:]</span>
			<span class="n">el</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">eli</span><span class="p">)</span> <span class="k">for</span> <span class="n">eli</span> <span class="ow">in</span> <span class="n">el</span><span class="p">]</span>
			<span class="k">if</span> <span class="n">connectivity</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span> <span class="n">connectivity</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">el</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
			
			<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_full_connectivity</span><span class="p">:</span>
				<span class="n">new_elem</span> <span class="o">=</span> <span class="n">felem</span><span class="p">(</span><span class="n">index</span> <span class="o">=</span> <span class="n">el</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">nodes</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">eli</span><span class="p">]</span> <span class="k">for</span> <span class="n">eli</span> <span class="ow">in</span> <span class="n">el</span><span class="p">[</span><span class="mi">1</span><span class="p">:]])</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">add_elem</span><span class="p">(</span><span class="n">new_elem</span><span class="p">)</span>
				<span class="k">if</span> <span class="n">connectivity</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span>
					<span class="n">nds1</span> <span class="o">=</span> <span class="p">[</span><span class="n">el</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">el</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">el</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">el</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span><span class="n">el</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span><span class="n">el</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span><span class="n">el</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span><span class="n">el</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span><span class="n">el</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span><span class="n">el</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span><span class="n">el</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">el</span><span class="p">[</span><span class="mi">5</span><span class="p">]]</span>
					<span class="n">nds2</span> <span class="o">=</span> <span class="p">[</span><span class="n">el</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span><span class="n">el</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">el</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span><span class="n">el</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span><span class="n">el</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span><span class="n">el</span><span class="p">[</span><span class="mi">8</span><span class="p">],</span><span class="n">el</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span><span class="n">el</span><span class="p">[</span><span class="mi">8</span><span class="p">],</span><span class="n">el</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span><span class="n">el</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">el</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span><span class="n">el</span><span class="p">[</span><span class="mi">8</span><span class="p">]]</span>
				<span class="k">elif</span> <span class="n">connectivity</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
					<span class="n">nds1</span> <span class="o">=</span> <span class="p">[</span><span class="n">el</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">el</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">el</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span><span class="n">el</span><span class="p">[</span><span class="mi">4</span><span class="p">]]</span>
					<span class="n">nds2</span> <span class="o">=</span> <span class="p">[</span><span class="n">el</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">el</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span><span class="n">el</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span><span class="n">el</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
				<span class="k">elif</span> <span class="n">connectivity</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
					<span class="n">nds1</span> <span class="o">=</span> <span class="p">[</span><span class="n">el</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">el</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">el</span><span class="p">[</span><span class="mi">3</span><span class="p">]]</span>
					<span class="n">nds2</span> <span class="o">=</span> <span class="p">[</span><span class="n">el</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">el</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span><span class="n">el</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
				<span class="k">else</span><span class="p">:</span>
					<span class="nb">print</span> <span class="s1">&#39;ERROR: unrecognized connectivity&#39;</span><span class="p">;</span> <span class="k">return</span>
				<span class="k">for</span> <span class="n">nd1</span><span class="p">,</span><span class="n">nd2</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">nds1</span><span class="p">,</span><span class="n">nds2</span><span class="p">):</span>
					<span class="k">if</span> <span class="n">nd1</span><span class="o">&gt;</span><span class="n">nd2</span><span class="p">:</span> <span class="n">ndi</span> <span class="o">=</span> <span class="n">nd2</span><span class="p">;</span> <span class="n">nd2</span> <span class="o">=</span> <span class="n">nd1</span><span class="p">;</span> <span class="n">nd1</span> <span class="o">=</span> <span class="n">ndi</span>
					<span class="n">nd1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">nd1</span><span class="p">];</span> <span class="n">nd2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">nd2</span><span class="p">]</span>
					<span class="n">new_conn</span> <span class="o">=</span> <span class="n">fconn</span><span class="p">(</span><span class="n">nodes</span> <span class="o">=</span> <span class="p">[</span><span class="n">nd1</span><span class="p">,</span><span class="n">nd2</span><span class="p">])</span>
					
					<span class="n">nd1inds</span> <span class="o">=</span> <span class="p">[]</span>
					<span class="k">for</span> <span class="n">con</span> <span class="ow">in</span> <span class="n">nd1</span><span class="o">.</span><span class="n">connections</span><span class="p">:</span>
						<span class="k">for</span> <span class="n">nd</span> <span class="ow">in</span> <span class="n">con</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span> <span class="n">nd1inds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nd</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
					
					<span class="k">if</span> <span class="n">nd2</span><span class="o">.</span><span class="n">index</span> <span class="ow">in</span> <span class="n">nd1inds</span><span class="p">:</span> <span class="k">continue</span>
					
					<span class="bp">self</span><span class="o">.</span><span class="n">add_conn</span><span class="p">(</span><span class="n">new_conn</span><span class="p">)</span>
					<span class="n">nd1</span><span class="o">.</span><span class="n">connections</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_conn</span><span class="p">)</span>
					<span class="n">nd2</span><span class="o">.</span><span class="n">connections</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_conn</span><span class="p">)</span>
				<span class="c1"># associate element nodes with element</span>
				<span class="k">for</span> <span class="n">nd</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">elemlist</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span> 
					<span class="bp">self</span><span class="o">.</span><span class="n">_node</span><span class="p">[</span><span class="n">nd</span><span class="o">.</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">elemlist</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>		
			<span class="k">else</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">_elemlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">el</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">_elem</span><span class="p">[</span><span class="n">el</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">elemlist</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
		<span class="n">infile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>		
		<span class="k">if</span> <span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">([</span><span class="n">nd</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">nd</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodelist</span><span class="p">]))</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">or</span>
			 <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">([</span><span class="n">nd</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">nd</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodelist</span><span class="p">]))</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">or</span>
			 <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">([</span><span class="n">nd</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">nd</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodelist</span><span class="p">]))</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)):</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">_dimensions</span> <span class="o">=</span> <span class="mi">2</span>
		<span class="k">else</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dimensions</span> <span class="o">=</span> <span class="mi">3</span>
<div class="viewcode-block" id="fgrid.write"><a class="viewcode-back" href="../fgrid.html#fgrid.fgrid.write">[docs]</a>	<span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="nb">format</span><span class="o">=</span><span class="s1">&#39;fehm&#39;</span><span class="p">,</span> <span class="n">compression</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;Write grid object to a grid file (FEHM, AVS STOR file formats supported). Stor file support only for orthogonal hexahedral grids.</span>

<span class="sd">		:param filename: name of FEHM grid file to write to, including path specification, e.g. c:\\path\\file_out.inp</span>
<span class="sd">		:type filename: str</span>
<span class="sd">		:param format: FEHM grid file format (&#39;fehm&#39;,&#39;avs&#39;,&#39;stor&#39;). Defaults to &#39;fehm&#39; unless filename is passed with extension &#39;*.avs&#39; or &#39;*.stor&#39;.</span>
<span class="sd">		:type format: str</span>
<span class="sd">		:param compression: Use maximum compression when generating stor files (default = True).</span>
<span class="sd">		:type compression: bool</span>

<span class="sd">		&quot;&quot;&quot;</span>
		
		<span class="c1"># autodetect format</span>
		<span class="k">if</span> <span class="n">filename</span><span class="p">:</span>
			<span class="n">extension</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
			<span class="k">if</span> <span class="n">extension</span> <span class="o">==</span> <span class="s1">&#39;avs&#39;</span><span class="p">:</span> <span class="nb">format</span> <span class="o">=</span> <span class="s1">&#39;avs&#39;</span>
			<span class="k">elif</span> <span class="n">extension</span> <span class="o">==</span> <span class="s1">&#39;stor&#39;</span><span class="p">:</span> <span class="nb">format</span> <span class="o">=</span> <span class="s1">&#39;stor&#39;</span>
		
		<span class="k">if</span> <span class="nb">format</span> <span class="o">==</span> <span class="s1">&#39;stor&#39;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_full_connectivity</span><span class="p">:</span>
			<span class="nb">print</span> <span class="s1">&#39;ERROR: STOR file cannot be written without full connectivity information. Read or create grid file with flag full_connectivity=True&#39;</span><span class="p">;</span> <span class="k">return</span>

		<span class="k">if</span> <span class="nb">format</span> <span class="o">==</span> <span class="s1">&#39;stor&#39;</span><span class="p">:</span> <span class="n">temp_path</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">)</span>		<span class="c1"># save path</span>
		<span class="k">if</span> <span class="n">filename</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="o">.</span><span class="n">filename</span><span class="o">=</span><span class="n">filename</span>
		<span class="k">if</span> <span class="n">filename</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="o">.</span><span class="n">filename</span><span class="o">=</span><span class="s1">&#39;default_GRID.inp&#39;</span>
		
		<span class="c1"># ASSUME THAT IF FILENAME IS PASSED - THIS IS WHERE THE FILE WILL BE WRITTEN</span>
		<span class="k">if</span> <span class="n">filename</span><span class="p">:</span>
			<span class="k">try</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="o">.</span><span class="n">absolute_to_file</span><span class="p">)</span>
			<span class="k">except</span><span class="p">:</span> <span class="k">pass</span>
			<span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="o">.</span><span class="n">full_path</span>
		<span class="c1"># IF FILE NAME IS NOT PASSED, GRID WILL BE WRITTEN TO WORK DIRECTORY IF IT EXISTS, OR CURRENT IF NOT</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="p">:</span> 	<span class="c1"># HAVE PARENT?</span>
				<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">work_dir</span><span class="p">:</span>	<span class="c1"># HAVE WORKING DIRECTORY?</span>
					<span class="k">try</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="o">.</span><span class="n">absolute_to_workdir</span><span class="p">)</span>
					<span class="k">except</span><span class="p">:</span>	<span class="k">pass</span>
					<span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="o">.</span><span class="n">absolute_to_workdir</span><span class="o">+</span><span class="n">slash</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="o">.</span><span class="n">filename</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="o">.</span><span class="n">full_path</span>
		
		<span class="n">outfile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
		
		<span class="k">if</span> <span class="nb">format</span> <span class="o">==</span> <span class="s1">&#39;fehm&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_write_fehm</span><span class="p">(</span><span class="n">outfile</span><span class="p">)</span>
		<span class="k">elif</span> <span class="nb">format</span> <span class="o">==</span> <span class="s1">&#39;avs&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_write_avs</span><span class="p">(</span><span class="n">outfile</span><span class="p">)</span>
		<span class="k">elif</span> <span class="nb">format</span> <span class="o">==</span> <span class="s1">&#39;stor&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_write_stor</span><span class="p">(</span><span class="n">outfile</span><span class="p">,</span><span class="n">compression</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span> <span class="nb">print</span> <span class="s1">&#39;ERROR: Unrecognized format &#39;</span><span class="o">+</span><span class="nb">format</span><span class="o">+</span><span class="s1">&#39;.&#39;</span><span class="p">;</span> <span class="k">return</span>
		
		<span class="k">if</span> <span class="nb">format</span> <span class="o">==</span> <span class="s1">&#39;stor&#39;</span><span class="p">:</span> 
			<span class="bp">self</span><span class="o">.</span><span class="n">_path</span> <span class="o">=</span> <span class="n">temp_path</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">ctrl</span><span class="p">[</span><span class="s1">&#39;stor_file_LDA&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">files</span><span class="o">.</span><span class="n">stor</span> <span class="o">=</span> <span class="n">path</span></div>
	<span class="k">def</span> <span class="nf">_write_fehm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">outfile</span><span class="p">):</span>
			
		<span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;coor</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
		<span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;   &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodelist</span><span class="p">))</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>		
		<span class="k">for</span> <span class="n">nd</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodelist</span><span class="p">:</span> 
			<span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%11d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">nd</span><span class="o">.</span><span class="n">index</span> <span class="o">+</span><span class="s1">&#39;        &#39;</span><span class="p">)</span>
			<span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%14.8f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">nd</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;        &#39;</span><span class="p">)</span>
			<span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%14.8f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">nd</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;        &#39;</span><span class="p">)</span>
			<span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%14.8f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">nd</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
			<span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>			
		<span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">0</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
		<span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;elem</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_full_connectivity</span><span class="p">:</span>
			<span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">elemlist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">nodes</span><span class="p">))</span><span class="o">+</span><span class="s1">&#39; &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">elemlist</span><span class="p">))</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>	
			<span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">elemlist</span><span class="p">:</span>
				<span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">el</span><span class="o">.</span><span class="n">index</span><span class="p">))</span><span class="o">+</span><span class="s1">&#39;   &#39;</span><span class="p">)</span>
				<span class="k">for</span> <span class="n">nd</span> <span class="ow">in</span> <span class="n">el</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span>
					<span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">nd</span><span class="o">.</span><span class="n">index</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;   &#39;</span><span class="p">)</span>
				<span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>	
		<span class="k">else</span><span class="p">:</span>
			<span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">elemlist</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span><span class="o">+</span><span class="s1">&#39; &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">elemlist</span><span class="p">))</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>	
			<span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">el</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">elemlist</span><span class="p">):</span>
				<span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;   &#39;</span><span class="p">)</span>
				<span class="k">for</span> <span class="n">nd</span> <span class="ow">in</span> <span class="n">el</span><span class="p">:</span>
					<span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">nd</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;   &#39;</span><span class="p">)</span>
				<span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>		
			
		<span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">stop</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
		<span class="n">outfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
	<span class="k">def</span> <span class="nf">_write_avs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">outfile</span><span class="p">):</span>
		<span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">number_nodes</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">number_elems</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; 0 0 0</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
		<span class="k">for</span> <span class="n">nd</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodelist</span><span class="p">:</span> 
			<span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%11d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">nd</span><span class="o">.</span><span class="n">index</span> <span class="o">+</span><span class="s1">&#39;        &#39;</span><span class="p">)</span>
			<span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%14.8f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">nd</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;        &#39;</span><span class="p">)</span>
			<span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%14.8f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">nd</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;        &#39;</span><span class="p">)</span>
			<span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%14.8f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">nd</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
			<span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
			
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_full_connectivity</span><span class="p">:</span>			
			<span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">elemlist</span><span class="p">:</span>
				<span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">el</span><span class="o">.</span><span class="n">index</span><span class="p">))</span><span class="o">+</span><span class="s1">&#39;   1  &#39;</span><span class="p">)</span>
				<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">el</span><span class="o">.</span><span class="n">nodes</span><span class="p">)</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span> <span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;hex  &#39;</span><span class="p">)</span>
				<span class="k">for</span> <span class="n">nd</span> <span class="ow">in</span> <span class="n">el</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span>
					<span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">nd</span><span class="o">.</span><span class="n">index</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;   &#39;</span><span class="p">)</span>
				<span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>		
			<span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">el</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">elemlist</span><span class="p">):</span>
				<span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;   1  &#39;</span><span class="p">)</span>
				<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">el</span><span class="p">)</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span> <span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;hex  &#39;</span><span class="p">)</span>
				<span class="k">for</span> <span class="n">nd</span> <span class="ow">in</span> <span class="n">el</span><span class="p">:</span>
					<span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">nd</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;   &#39;</span><span class="p">)</span>
				<span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
		<span class="n">outfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
	<span class="k">def</span> <span class="nf">_write_stor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">outfile</span><span class="p">,</span><span class="n">compression</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
		<span class="c1"># calculate volumes and geometric coefficients</span>
		<span class="k">for</span> <span class="n">conn</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">connlist</span><span class="p">:</span> <span class="n">conn</span><span class="o">.</span><span class="n">_geom_coef</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="k">for</span> <span class="n">nd</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodelist</span><span class="p">:</span> <span class="n">nd</span><span class="o">.</span><span class="n">_vol</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="k">for</span> <span class="n">nd</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodelist</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">_vorvol</span><span class="p">(</span><span class="n">nd</span><span class="p">)</span> 		<span class="c1"># calculate voronoi volume of node</span>
		<span class="c1"># calculate reduced coefficient list</span>
		<span class="k">if</span> <span class="n">compression</span><span class="p">:</span>
			<span class="n">tol</span> <span class="o">=</span> <span class="mf">1.e-5</span>
			<span class="n">indices1</span> <span class="o">=</span> <span class="p">[]</span> 			<span class="c1"># for populating later</span>
			<span class="n">geom_coefs</span> <span class="o">=</span> <span class="p">[</span><span class="n">con</span><span class="o">.</span><span class="n">geom_coef</span> <span class="k">for</span> <span class="n">con</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">connlist</span><span class="p">]</span> 	<span class="c1"># all coefficients</span>
			<span class="n">gcU</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">geom_coefs</span><span class="p">)))[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="mf">0.</span>
			<span class="n">NgcU</span> <span class="o">=</span> <span class="mi">0</span>
			<span class="k">for</span> <span class="n">gc</span> <span class="ow">in</span> <span class="n">geom_coefs</span><span class="p">:</span>
				<span class="n">new_gcU</span> <span class="o">=</span> <span class="kc">True</span>
				<span class="n">dgcu</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">((</span><span class="n">gc</span><span class="o">-</span><span class="n">gcU</span><span class="p">[:</span><span class="n">NgcU</span><span class="p">])</span><span class="o">/</span><span class="n">gc</span><span class="p">)</span> 		<span class="c1"># distances between geom_coef and existing bins</span>
				<span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">dgcu</span><span class="o">&gt;</span><span class="n">tol</span><span class="p">):</span> 
					<span class="n">gcU</span><span class="p">[</span><span class="n">NgcU</span><span class="p">]</span> <span class="o">=</span> <span class="n">gc</span>
					<span class="n">NgcU</span> <span class="o">+=</span> <span class="mi">1</span>
			<span class="n">gcU</span><span class="p">[</span><span class="n">NgcU</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.</span>
			<span class="n">gcU</span> <span class="o">=</span> <span class="n">gcU</span><span class="p">[:</span><span class="n">NgcU</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
			<span class="n">gcU</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
			
		<span class="c1"># write file</span>
		<span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;fehmstor ascir8i4 PyFEHM Sparse Matrix Voronoi Coefficients</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
		<span class="kn">import</span> <span class="nn">time</span>
		<span class="n">lt</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">localtime</span><span class="p">()</span>
		<span class="n">mon</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">lt</span><span class="o">.</span><span class="n">tm_mon</span><span class="p">)</span>
		<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mon</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> <span class="n">mon</span> <span class="o">=</span> <span class="s1">&#39;0&#39;</span><span class="o">+</span><span class="n">mon</span>
		<span class="n">day</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">lt</span><span class="o">.</span><span class="n">tm_mday</span><span class="p">)</span>
		<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">day</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> <span class="n">day</span> <span class="o">=</span> <span class="s1">&#39;0&#39;</span><span class="o">+</span><span class="n">day</span>
		<span class="n">yr</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">lt</span><span class="o">.</span><span class="n">tm_year</span><span class="p">)</span>
		<span class="n">hr</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">lt</span><span class="o">.</span><span class="n">tm_hour</span><span class="p">)</span>
		<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">hr</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> <span class="n">hr</span> <span class="o">=</span> <span class="s1">&#39;0&#39;</span><span class="o">+</span><span class="n">hr</span>
		<span class="nb">min</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">lt</span><span class="o">.</span><span class="n">tm_min</span><span class="p">)</span>
		<span class="n">sec</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">lt</span><span class="o">.</span><span class="n">tm_sec</span><span class="p">)</span>
		<span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">mon</span><span class="o">+</span><span class="s1">&#39;/&#39;</span><span class="o">+</span><span class="n">day</span><span class="o">+</span><span class="s1">&#39;/&#39;</span><span class="o">+</span><span class="n">yr</span><span class="o">+</span><span class="s1">&#39;    &#39;</span><span class="o">+</span><span class="n">hr</span><span class="o">+</span><span class="s1">&#39;:&#39;</span><span class="o">+</span><span class="nb">min</span><span class="o">+</span><span class="s1">&#39;:&#39;</span><span class="o">+</span><span class="n">sec</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
		
		<span class="c1"># write matrix parameters</span>
		<span class="n">Nnds</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodelist</span><span class="p">)</span>
		<span class="n">Ncons</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">connlist</span><span class="p">)</span><span class="o">+</span><span class="n">Nnds</span>
		<span class="k">if</span> <span class="n">compression</span><span class="p">:</span>
			<span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="si">%5i</span><span class="s1">&#39;</span><span class="o">%</span><span class="nb">len</span><span class="p">(</span><span class="n">gcU</span><span class="p">))</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="si">%5i</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">Ncons</span><span class="p">)</span>
		<span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="si">%5i</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">Nnds</span><span class="p">)</span>
		<span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="si">%5i</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">Nnds</span><span class="o">+</span><span class="n">Ncons</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
		<span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="si">%5i</span><span class="s1">&#39;</span><span class="o">%</span><span class="mi">1</span><span class="p">)</span>
		<span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="si">%5i</span><span class="s1">&#39;</span><span class="o">%</span><span class="mi">7</span><span class="p">)</span>
		<span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

		<span class="c1"># write Voronoi Volumes</span>
		<span class="n">cnt</span> <span class="o">=</span> <span class="mi">0</span>
		<span class="k">for</span> <span class="n">nd</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodelist</span><span class="p">:</span>
			<span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;  </span><span class="si">%13.12E</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">nd</span><span class="o">.</span><span class="n">vol</span><span class="p">)</span>
			<span class="n">cnt</span> <span class="o">+=</span><span class="mi">1</span>
			<span class="k">if</span> <span class="n">cnt</span> <span class="o">==</span><span class="mi">5</span><span class="p">:</span> 
				<span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
				<span class="n">cnt</span> <span class="o">=</span> <span class="mi">0</span>			
		<span class="k">if</span> <span class="n">cnt</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span> <span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
				
		<span class="c1"># write sparse matrix connectivity</span>
		<span class="n">sparse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="n">Ncons</span><span class="o">+</span><span class="n">Nnds</span><span class="o">+</span><span class="mi">1</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
		<span class="n">gcStr</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
		<span class="n">cnt</span> <span class="o">=</span> <span class="mi">0</span>
		<span class="n">stride</span> <span class="o">=</span> <span class="n">Nnds</span><span class="o">+</span><span class="mi">1</span>
		<span class="n">diagonals</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">nd</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodelist</span><span class="p">):</span>
			<span class="c1"># populate sparse</span>
			<span class="c1"># add the stride</span>
			<span class="n">sparse</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">stride</span>
			<span class="n">diagonals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stride</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
			<span class="c1"># add the connections</span>
			<span class="n">cons</span> <span class="o">=</span> <span class="p">[]</span>
			<span class="k">for</span> <span class="n">con</span> <span class="ow">in</span> <span class="n">nd</span><span class="o">.</span><span class="n">connections</span><span class="p">:</span>
				<span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">index</span> <span class="o">==</span> <span class="n">nd</span><span class="o">.</span><span class="n">index</span><span class="p">:</span> <span class="n">cons</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">con</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span><span class="n">con</span><span class="o">.</span><span class="n">geom_coef</span><span class="p">])</span>
				<span class="k">else</span><span class="p">:</span> <span class="n">cons</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">con</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span><span class="n">con</span><span class="o">.</span><span class="n">geom_coef</span><span class="p">])</span>
			<span class="n">cons</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">nd</span><span class="o">.</span><span class="n">index</span><span class="p">,</span><span class="mf">0.</span><span class="p">])</span>
			<span class="n">cons</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
			<span class="k">for</span> <span class="n">j</span><span class="p">,</span><span class="n">con</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">cons</span><span class="p">):</span>
				<span class="k">if</span> <span class="n">con</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">nd</span><span class="o">.</span><span class="n">index</span><span class="p">:</span> <span class="n">diagonals</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">j</span>
				<span class="c1"># add connection to sparse</span>
				<span class="n">sparse</span><span class="p">[</span><span class="n">stride</span><span class="p">]</span> <span class="o">=</span> <span class="n">con</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
				<span class="n">stride</span> <span class="o">+=</span><span class="mi">1</span> 	<span class="c1"># increment the stride</span>
				<span class="c1"># write geometric coefficients</span>
				<span class="n">gcStr</span> <span class="o">+=</span><span class="s1">&#39;  </span><span class="si">%13.12E</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">con</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
				<span class="k">if</span> <span class="n">compression</span><span class="p">:</span> <span class="n">indices1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">gcU</span><span class="o">-</span><span class="n">con</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">argmin</span><span class="p">()</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
				<span class="n">cnt</span> <span class="o">+=</span><span class="mi">1</span>
				<span class="k">if</span> <span class="n">cnt</span> <span class="o">==</span><span class="mi">5</span><span class="p">:</span> 
					<span class="n">gcStr</span><span class="o">+=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
					<span class="n">cnt</span> <span class="o">=</span> <span class="mi">0</span>			
		<span class="k">if</span> <span class="n">cnt</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span> <span class="n">gcStr</span><span class="o">+=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
		<span class="n">sparse</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">stride</span>
		
		<span class="c1"># row entries</span>
		<span class="n">cnt</span> <span class="o">=</span> <span class="mi">0</span>
		<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">sparse</span><span class="p">:</span>
			<span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;  </span><span class="si">%6i</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">i</span><span class="p">)</span>
			<span class="n">cnt</span> <span class="o">+=</span><span class="mi">1</span>
			<span class="k">if</span> <span class="n">cnt</span> <span class="o">==</span><span class="mi">5</span><span class="p">:</span> 
				<span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
				<span class="n">cnt</span> <span class="o">=</span> <span class="mi">0</span>			
		<span class="k">if</span> <span class="n">cnt</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span> <span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
				
		<span class="c1"># indices into coefficient list</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="n">compression</span><span class="p">:</span> <span class="n">indices1</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">Ncons</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
		
		<span class="n">indices</span> <span class="o">=</span> <span class="n">indices1</span><span class="o">+</span><span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="n">Nnds</span><span class="o">+</span><span class="mi">1</span><span class="p">))[</span><span class="mi">0</span><span class="p">])</span>
		<span class="n">cnt</span> <span class="o">=</span> <span class="mi">0</span>
		<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">:</span>
			<span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;  </span><span class="si">%6i</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">i</span><span class="p">)</span>
			<span class="n">cnt</span> <span class="o">+=</span><span class="mi">1</span>
			<span class="k">if</span> <span class="n">cnt</span> <span class="o">==</span><span class="mi">5</span><span class="p">:</span> 
				<span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
				<span class="n">cnt</span> <span class="o">=</span> <span class="mi">0</span>			
		<span class="k">if</span> <span class="n">cnt</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span> <span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
		<span class="n">cnt</span> <span class="o">=</span> <span class="mi">0</span>
		<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">diagonals</span><span class="p">:</span>
			<span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;  </span><span class="si">%6i</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">i</span><span class="p">)</span>
			<span class="n">cnt</span> <span class="o">+=</span><span class="mi">1</span>
			<span class="k">if</span> <span class="n">cnt</span> <span class="o">==</span><span class="mi">5</span><span class="p">:</span> 
				<span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
				<span class="n">cnt</span> <span class="o">=</span> <span class="mi">0</span>			
		<span class="k">if</span> <span class="n">cnt</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span> <span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
				
		<span class="c1"># geometric area coefficient values</span>
		<span class="k">if</span> <span class="n">compression</span><span class="p">:</span>
			<span class="n">cnt</span> <span class="o">=</span> <span class="mi">0</span>
			<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">gcU</span><span class="p">:</span>
				<span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;  </span><span class="si">%13.12E</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">i</span><span class="p">)</span>
				<span class="n">cnt</span> <span class="o">+=</span><span class="mi">1</span>
				<span class="k">if</span> <span class="n">cnt</span> <span class="o">==</span><span class="mi">5</span><span class="p">:</span> 
					<span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
					<span class="n">cnt</span> <span class="o">=</span> <span class="mi">0</span>			
			<span class="k">if</span> <span class="n">cnt</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span> <span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">gcStr</span><span class="p">)</span>
		<span class="n">outfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
	<span class="k">def</span> <span class="nf">_vorvol</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">nd</span><span class="p">):</span>
		<span class="c1"># array of connection mid-point positions</span>
		<span class="n">pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([(</span><span class="n">con</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">position</span><span class="o">+</span><span class="n">con</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">position</span><span class="p">)</span><span class="o">/</span><span class="mf">2.</span> <span class="k">for</span> <span class="n">con</span> <span class="ow">in</span> <span class="n">nd</span><span class="o">.</span><span class="n">connections</span><span class="p">])</span>
		<span class="c1"># min and max of these mid-points, use to find bounding box of volume</span>
		<span class="n">xm</span><span class="p">,</span><span class="n">ym</span><span class="p">,</span><span class="n">zm</span><span class="p">,</span><span class="n">xM</span><span class="p">,</span><span class="n">yM</span><span class="p">,</span><span class="n">zM</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">pos</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]),</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">pos</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]),</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">pos</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]),</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">pos</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]),</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">pos</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]),</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">pos</span><span class="p">[:,</span><span class="mi">2</span><span class="p">])</span>
		<span class="c1"># calculate volume</span>
		<span class="n">nd</span><span class="o">.</span><span class="n">_vol</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">([</span><span class="n">xM</span><span class="o">-</span><span class="n">xm</span><span class="p">,</span><span class="n">yM</span><span class="o">-</span><span class="n">ym</span><span class="p">,</span><span class="n">zM</span><span class="o">-</span><span class="n">zm</span><span class="p">])</span>
		<span class="n">areas</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="p">(</span><span class="n">yM</span><span class="o">-</span><span class="n">ym</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">zM</span><span class="o">-</span><span class="n">zm</span><span class="p">),</span><span class="o">-</span><span class="p">(</span><span class="n">xM</span><span class="o">-</span><span class="n">xm</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">zM</span><span class="o">-</span><span class="n">zm</span><span class="p">),</span><span class="o">-</span><span class="p">(</span><span class="n">yM</span><span class="o">-</span><span class="n">ym</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">xM</span><span class="o">-</span><span class="n">xm</span><span class="p">)]</span> 	<span class="c1"># interface areas</span>
		
		<span class="k">for</span> <span class="n">con</span> <span class="ow">in</span> <span class="n">nd</span><span class="o">.</span><span class="n">connections</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">geom_coef</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span> <span class="k">continue</span>
			<span class="c1"># establish direction of connection</span>
			<span class="n">N</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">position</span> <span class="o">-</span> <span class="n">con</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">position</span><span class="p">)</span>
			<span class="k">if</span> <span class="n">N</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&gt;</span><span class="n">N</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span> <span class="n">N</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&gt;</span><span class="n">N</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>	
				<span class="n">con</span><span class="o">.</span><span class="n">_geom_coef</span> <span class="o">=</span> <span class="n">areas</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">distance</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span>
			<span class="k">elif</span> <span class="n">N</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">&gt;</span><span class="n">N</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">N</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">&gt;</span><span class="n">N</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>	
				<span class="n">con</span><span class="o">.</span><span class="n">_geom_coef</span> <span class="o">=</span> <span class="n">areas</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">distance</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span>
			<span class="k">elif</span> <span class="n">N</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">&gt;</span><span class="n">N</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span> <span class="n">N</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">&gt;</span><span class="n">N</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>	
				<span class="n">con</span><span class="o">.</span><span class="n">_geom_coef</span> <span class="o">=</span> <span class="n">areas</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">distance</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span>
<div class="viewcode-block" id="fgrid.make"><a class="viewcode-back" href="../fgrid.html#fgrid.fgrid.make">[docs]</a>	<span class="k">def</span> <span class="nf">make</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">gridfilename</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="n">full_connectivity</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">octree</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot; Generates an orthogonal mesh for input node positions. </span>
<span class="sd">		</span>
<span class="sd">		The mesh is constructed using the ``fgrid.``\ **fmake** object and an FEHM grid file is written for the mesh.</span>
<span class="sd">		</span>
<span class="sd">		:param gridfilename: Name to which to save the grid file.</span>
<span class="sd">		:type gridfilename: str</span>
<span class="sd">		:param x: Unique set of x-coordinates.</span>
<span class="sd">		:type x: list[fl64]</span>
<span class="sd">		:param y: Unique set of y-coordinates.</span>
<span class="sd">		:type y: list[fl64]</span>
<span class="sd">		:param z: Unique set of z-coordinates.</span>
<span class="sd">		:type z: list[fl64]</span>
<span class="sd">		:param full_connectivity: read element and connection data and construct corresponding objects. Defaults to False. Use if access to connectivity information will be useful.</span>
<span class="sd">		:type full_connectivity: bool</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="c1"># ASSUMPTIONS FOR MAKE</span>
		<span class="c1"># if no parent - interpret string literally</span>
		<span class="c1"># if parent but NO work dir - interpret string literally</span>
		<span class="c1"># if parent and work dir but relative or absolute - interpret string relative to cwd</span>
		<span class="c1"># if parent and work dir and grid name ONLY - grid goes in work dir</span>
		
		<span class="c1"># PASS FULL PATH specification into fmake</span>
		
		<span class="n">temp_path</span> <span class="o">=</span> <span class="n">fpath</span><span class="p">()</span>
		<span class="n">temp_path</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">gridfilename</span>
		
		<span class="n">path</span> <span class="o">=</span> <span class="n">temp_path</span><span class="o">.</span><span class="n">full_path</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="p">:</span>
			<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">work_dir</span><span class="p">:</span>
				<span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="o">.</span><span class="n">absolute_to_workdir</span><span class="o">+</span><span class="n">slash</span><span class="o">+</span><span class="n">temp_path</span><span class="o">.</span><span class="n">filename</span>
		
		<span class="n">fm</span> <span class="o">=</span> <span class="n">fmake</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">)</span>
		<span class="n">fm</span><span class="o">.</span><span class="n">write</span><span class="p">()</span>		
		<span class="bp">self</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="n">full_connectivity</span><span class="p">,</span><span class="n">octree</span><span class="p">)</span></div>
<div class="viewcode-block" id="fgrid.lagrit_stor"><a class="viewcode-back" href="../fgrid.html#fgrid.fgrid.lagrit_stor">[docs]</a>	<span class="k">def</span> <span class="nf">lagrit_stor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">grid</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">stor</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">exe</span> <span class="o">=</span> <span class="n">dflt</span><span class="o">.</span><span class="n">lagrit_path</span><span class="p">,</span> <span class="n">overwrite</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;Uses LaGriT to create a stor file for the simulation, this will be used in subsequent runs.</span>
<span class="sd">		To create the stor file, LaGriT will convert a mesh comprised of hexahedral elements into one comprising</span>
<span class="sd">		only tetrahedrals. Therefore, a new FEHM grid file will be created and parsed, reflecting the modified </span>
<span class="sd">		element structure.</span>
<span class="sd">		</span>
<span class="sd">		:param grid: Name of grid file to be created. Destination directory supported.</span>
<span class="sd">		:type grid: str</span>
<span class="sd">		:param stor: Name of stor file to be created. Destination directory supported.</span>
<span class="sd">		:type stor: str</span>
<span class="sd">		:param exe: Path to lagrit executable (default, fdflt.lagrit_path, in environment file &#39;fdflt.py&#39;).</span>
<span class="sd">		:type exe: str</span>
<span class="sd">		:param overwrite: Flag to request that the new FEHM grid file overwrites the old one.</span>
<span class="sd">		:type overwrite: bool</span>
<span class="sd">		</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span> <span class="nb">print</span> <span class="s1">&#39;ERROR: a grid must first be loaded/created before a stor file can be created.&#39;</span><span class="p">;</span> <span class="k">return</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">exe</span><span class="p">):</span> <span class="nb">print</span> <span class="s1">&#39;ERROR: cannot find lagrit executable at &#39;</span><span class="o">+</span><span class="n">exe</span><span class="p">;</span> <span class="k">return</span>
		
		<span class="c1"># assign default stor file name if none given</span>
		<span class="k">if</span> <span class="n">stor</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">stor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="o">.</span><span class="n">full_path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
			<span class="n">stor</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">stor</span><span class="p">,</span><span class="s1">&#39;.&#39;</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;.stor&#39;</span>
		<span class="c1"># assign default grid file name, location if none given</span>
		<span class="k">if</span> <span class="n">grid</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">grid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="o">.</span><span class="n">full_path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
			<span class="n">grid</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span><span class="s1">&#39;.&#39;</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;_lg.&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
		<span class="c1"># write mesh to avs</span>
		<span class="n">avs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
		<span class="n">avs</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">avs</span><span class="p">,</span><span class="s1">&#39;.&#39;</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;.avs&#39;</span>
		<span class="n">fname_save</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="o">.</span><span class="n">full_path</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">filename</span> <span class="o">=</span> <span class="n">avs</span><span class="p">,</span> <span class="nb">format</span> <span class="o">=</span> <span class="s1">&#39;avs&#39;</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">fname_save</span>
		
		<span class="c1"># create lagrit instruction file</span>
		<span class="n">fp</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;lagrit_instructions.lgi&#39;</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
		<span class="n">lns</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="n">lns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;# read the mesh in AVS format</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
		<span class="n">lns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;read avs &#39;</span><span class="o">+</span><span class="n">avs</span><span class="o">+</span><span class="s1">&#39; cmohex</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
		<span class="n">lns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
		<span class="n">lns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;# create a tet version of this point distribution</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
		<span class="n">lns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;cmo / create / cmotet / / / tet</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
		<span class="n">lns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;copypts / cmotet / cmohex</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
		<span class="n">lns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;  cmo / select cmotet</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
		<span class="n">lns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;  cmo / setatt / cmotet / imt / 1 0 0 / 1</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
		<span class="n">lns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;  cmo / setatt / cmotet / itp / 1 0 0 / 0</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
		<span class="n">lns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
		<span class="n">lns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;# remove duplicates</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
		<span class="n">lns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;filter / 1 0 0</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
		<span class="n">lns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;rmpoint / compress</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
		<span class="n">lns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
		<span class="n">lns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;# if sort is needed to reorder the nodes</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
		<span class="n">lns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;# otherwise keep same node odering and comment out</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
		<span class="n">lns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;#sort / cmotet / index / ascending / ikey / zic yic xic</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
		<span class="n">lns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;#reorder / cmotet / ikey</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
		<span class="n">lns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;#cmo / DELATT / cmotet / ikey</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
		<span class="n">lns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;#cmo / status</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
		<span class="n">lns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
		<span class="n">lns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;# connect into delaunay tet mesh </span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
		<span class="n">lns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;connect noadd</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
		<span class="n">lns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;resetpts / itp</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
		<span class="n">lns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;quality</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
		<span class="n">lns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
		<span class="n">lns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;# write tet and stor files</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
		<span class="n">lns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;dump fehm lagrit_out cmotet ascii </span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
		<span class="n">lns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
		<span class="n">lns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
		<span class="n">lns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;finish</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
		<span class="n">fp</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">lns</span><span class="p">)</span>
		<span class="n">fp</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
		
		<span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="n">exe</span><span class="o">+</span><span class="s1">&#39; &lt; lagrit_instructions.lgi &gt; nul&#39;</span><span class="p">)</span>
		<span class="c1"># isolate new grid and stor files, delete others</span>
		<span class="n">files</span> <span class="o">=</span> <span class="n">glob</span><span class="p">(</span><span class="s1">&#39;lagrit_out*.*&#39;</span><span class="p">)</span>
		<span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
			<span class="k">if</span> <span class="ow">not</span> <span class="n">file</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.stor&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">file</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.fehmn&#39;</span><span class="p">):</span>
				<span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
		<span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s1">&#39;lagrit_instructions.lgi&#39;</span><span class="p">)</span>
		<span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">avs</span><span class="p">)</span>
		
		<span class="c1"># rename and move files, parse</span>
		<span class="k">if</span> <span class="n">overwrite</span><span class="p">:</span> 	<span class="c1"># overwriting old grid file</span>
			<span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="s1">&#39;lagrit_out.fehmn&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="o">.</span><span class="n">full_path</span><span class="p">)</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="o">.</span><span class="n">full_path</span><span class="p">)</span>
		<span class="k">elif</span> <span class="n">grid</span><span class="p">:</span> 			<span class="c1"># grid name/location specified</span>
			<span class="n">temp_path</span> <span class="o">=</span> <span class="n">fpath</span><span class="p">()</span>
			<span class="n">temp_path</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">grid</span>
			<span class="k">try</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">temp_path</span><span class="o">.</span><span class="n">absolute_to_file</span><span class="p">)</span>
			<span class="k">except</span><span class="p">:</span> <span class="k">pass</span>
			<span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="s1">&#39;lagrit_out.fehmn&#39;</span><span class="p">,</span><span class="n">grid</span><span class="p">)</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">grid</span><span class="p">)</span>
		
		<span class="n">temp_path</span> <span class="o">=</span> <span class="n">fpath</span><span class="p">()</span>
		<span class="n">temp_path</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">stor</span>
		<span class="k">try</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">temp_path</span><span class="o">.</span><span class="n">absolute_to_file</span><span class="p">)</span>
		<span class="k">except</span><span class="p">:</span> <span class="k">pass</span>
		<span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="s1">&#39;lagrit_out.stor&#39;</span><span class="p">,</span><span class="n">stor</span><span class="p">)</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">files</span><span class="o">.</span><span class="n">stor</span> <span class="o">=</span> <span class="n">stor</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">ctrl</span><span class="p">[</span><span class="s1">&#39;stor_file_LDA&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span></div>
<div class="viewcode-block" id="fgrid.volumes"><a class="viewcode-back" href="../fgrid.html#fgrid.fgrid.volumes">[docs]</a>	<span class="k">def</span> <span class="nf">volumes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">volumefilename</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot; Reads a lagrit generated file containing control volume information.</span>
<span class="sd">		</span>
<span class="sd">		:param volumefilename: Name of lagrit output file containing control volume information.</span>
<span class="sd">		:type volumefilename: str</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">infile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">volumefilename</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
		<span class="n">line</span> <span class="o">=</span> <span class="n">infile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span> 
		<span class="n">line</span> <span class="o">=</span> <span class="n">infile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
		<span class="n">Ncol</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
		<span class="n">colnames</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Ncol</span><span class="p">):</span>
			<span class="n">line</span> <span class="o">=</span> <span class="n">infile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
			<span class="n">colnames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
		<span class="n">keepReading</span> <span class="o">=</span> <span class="kc">True</span>
		<span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">colnames</span><span class="p">):</span>
			<span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;vorvol&#39;</span><span class="p">:</span> <span class="k">break</span>
		<span class="k">while</span> <span class="n">keepReading</span><span class="p">:</span>
			<span class="n">line</span> <span class="o">=</span> <span class="n">infile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
			<span class="k">if</span> <span class="ow">not</span> <span class="n">line</span><span class="p">:</span> <span class="n">keepReading</span> <span class="o">=</span> <span class="kc">False</span><span class="p">;</span> <span class="k">continue</span>
			<span class="n">ndI</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
			<span class="n">ndV</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">ndI</span><span class="p">]</span><span class="o">.</span><span class="n">_vol</span> <span class="o">=</span> <span class="n">ndV</span></div>
	<span class="k">def</span> <span class="nf">add_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">node</span><span class="o">=</span><span class="n">fnode</span><span class="p">()):</span>		<span class="c1">#Add a node object.</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_nodelist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_node</span><span class="p">[</span><span class="n">node</span><span class="o">.</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nodelist</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
	<span class="k">def</span> <span class="nf">add_conn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">conn</span><span class="o">=</span><span class="n">fconn</span><span class="p">()):</span>		<span class="c1">#Add a connection object.</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_connlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">conn</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_conn</span><span class="p">[(</span><span class="n">conn</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span><span class="n">conn</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">)]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connlist</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
	<span class="k">def</span> <span class="nf">add_elem</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">elem</span><span class="o">=</span><span class="n">felem</span><span class="p">()):</span>		<span class="c1">#Add an element object.</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_elemlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_elem</span><span class="p">[</span><span class="n">elem</span><span class="o">.</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">elemlist</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<div class="viewcode-block" id="fgrid.node_nearest_point"><a class="viewcode-back" href="../fgrid.html#fgrid.fgrid.node_nearest_point">[docs]</a>	<span class="k">def</span> <span class="nf">node_nearest_point</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">pos</span> <span class="o">=</span> <span class="p">[]):</span>
		<span class="sd">&quot;&quot;&quot;Return node object nearest to position in space. Method uses octree structure for speed up if available.</span>

<span class="sd">		:param pos: Coordinates, e.g. [2300., -134.8, 0.].</span>
<span class="sd">		:type pos: list</span>
<span class="sd">		:returns:  fnode() -- node object closest to position.</span>

<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">octree</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">min_dist</span> <span class="o">=</span> <span class="mf">1.e10</span>
			<span class="n">nd</span> <span class="o">=</span> <span class="kc">None</span>
			<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">octree</span><span class="o">.</span><span class="n">leaf</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
				<span class="nb">print</span> <span class="s1">&#39;Error: point outside domain&#39;</span>
				<span class="k">return</span> <span class="kc">None</span>
			<span class="n">lf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">octree</span><span class="o">.</span><span class="n">leaf</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>
			<span class="n">min_dist</span><span class="o">=</span> <span class="mf">1.e10</span>
			
			<span class="k">for</span> <span class="n">leaf</span> <span class="ow">in</span> <span class="p">([</span><span class="n">lf</span><span class="p">,]</span><span class="o">+</span><span class="n">lf</span><span class="o">.</span><span class="n">neighbour</span><span class="p">):</span>
				<span class="k">if</span> <span class="n">leaf</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span> <span class="k">continue</span>
				<span class="n">dist</span><span class="p">,</span><span class="n">cube</span> <span class="o">=</span> <span class="n">leaf</span><span class="o">.</span><span class="n">min_dist</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>
				<span class="k">if</span> <span class="n">dist</span><span class="o">&lt;</span><span class="n">min_dist</span><span class="p">:</span> <span class="n">min_dist</span> <span class="o">=</span> <span class="n">dist</span><span class="p">;</span> <span class="n">min_cube</span> <span class="o">=</span> <span class="n">cube</span>
			<span class="k">return</span> <span class="n">min_cube</span><span class="o">.</span><span class="n">elements</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">_pos_matrix</span> <span class="o">-</span> <span class="n">pos</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">argmin</span><span class="p">()</span>
			<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodelist</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span></div>
	<span class="k">def</span> <span class="nf">nodes_nearest_points</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">points</span> <span class="o">=</span> <span class="p">[]):</span>
		<span class="sd">&quot;&quot;&quot;Return node objects nearest to position in space. Uses sKDTree for speed up.</span>
<span class="sd">		This is the &#39;vectorized&#39; version of &#39;fgrid.node_nearest_point&#39;, which only allows for </span>
<span class="sd">		a single point </span>
<span class="sd">	</span>
<span class="sd">		:param pos: Coordinates, e.g. [2300., -134.8, 0.] or [[2300., -134.8, 0.],[..],...]</span>
<span class="sd">		:type pos: list</span>
<span class="sd">		:returns:  list of fnode() -- list of node object closest to position.	</span>

<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">pytree</span> <span class="o">=</span> <span class="n">spsp</span><span class="o">.</span><span class="n">cKDTree</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_pos_matrix</span><span class="p">)</span>
		<span class="n">dist</span><span class="p">,</span> <span class="n">idxs</span> <span class="o">=</span> <span class="n">pytree</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>
		<span class="n">auxList</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
		<span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">idxs</span><span class="p">:</span>
		   <span class="n">auxList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodelist</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
		<span class="k">return</span> <span class="n">auxList</span>
<div class="viewcode-block" id="fgrid.plot"><a class="viewcode-back" href="../fgrid.html#fgrid.fgrid.plot">[docs]</a>	<span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">save</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">angle</span><span class="o">=</span><span class="p">[</span><span class="mi">45</span><span class="p">,</span><span class="mi">45</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">connections</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">equal_axes</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
		<span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;x / m&#39;</span><span class="p">,</span><span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;y / m&#39;</span><span class="p">,</span><span class="n">zlabel</span><span class="o">=</span><span class="s1">&#39;z / m&#39;</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">font_size</span><span class="o">=</span><span class="s1">&#39;small&#39;</span><span class="p">,</span><span class="n">cutaway</span><span class="o">=</span><span class="p">[]):</span> 		<span class="c1">#generates a 3-D plot of the zone.</span>
		<span class="sd">&quot;&quot;&quot;Generates and saves a 3-D plot of the grid.</span>
<span class="sd">		</span>
<span class="sd">		:param save: Name of saved zone image.</span>
<span class="sd">		:type save: str</span>
<span class="sd">		:param angle: 	View angle of zone. First number is tilt angle in degrees, second number is azimuth. Alternatively, if angle is &#39;x&#39;, &#39;y&#39;, &#39;z&#39;, view is aligned along the corresponding axis.</span>
<span class="sd">		:type angle: [fl64,fl64], str</span>
<span class="sd">		:param color: Colour of zone.</span>
<span class="sd">		:type color: str, [fl64,fl64,fl64]</span>
<span class="sd">		:param connections: Plot connections. If ``True`` all connections plotted. If between 0 and 1, random proportion plotted. If greater than 1, specified number plotted.</span>
<span class="sd">		:type connections: bool</span>
<span class="sd">		:param equal_axes: Force plotting with equal aspect ratios for all axes.</span>
<span class="sd">		:type equal_axes: bool</span>
<span class="sd">		</span>
<span class="sd">		:param xlabel: Label on x-axis.</span>
<span class="sd">		:type xlabel: str</span>
<span class="sd">		:param ylabel: Label on y-axis.</span>
<span class="sd">		:type ylabel: str</span>
<span class="sd">		:param zlabel: Label on z-axis.</span>
<span class="sd">		:type zlabel: str</span>
<span class="sd">		:param title: Title of plot.</span>
<span class="sd">		:type title: str</span>
<span class="sd">		</span>
<span class="sd">		:param font_size: Size of text on plot.</span>
<span class="sd">		:type font_size: str, int</span>
<span class="sd">		</span>
<span class="sd">		:param cutaway: Coordinate from which cutaway begins. Alternatively, specifying &#39;middle&#39;,&#39;centre&#39; with choose the centre of the grid as the cutaway point.</span>
<span class="sd">		:type cutaway: [fl64,fl64,fl64], str</span>
<span class="sd">		</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="n">save</span><span class="p">:</span> <span class="n">save</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;.png&#39;</span>
		<span class="k">if</span> <span class="n">cutaway</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;middle&#39;</span><span class="p">,</span><span class="s1">&#39;center&#39;</span><span class="p">,</span><span class="s1">&#39;centre&#39;</span><span class="p">,</span><span class="s1">&#39;mid&#39;</span><span class="p">]:</span>			
			<span class="n">cutaway</span> <span class="o">=</span> <span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">xmin</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">xmax</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,(</span><span class="bp">self</span><span class="o">.</span><span class="n">ymin</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">ymax</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,(</span><span class="bp">self</span><span class="o">.</span><span class="n">zmin</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">zmax</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">]</span>
		<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">angle</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
			<span class="k">if</span> <span class="n">angle</span> <span class="o">==</span> <span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="n">angle</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
			<span class="k">elif</span> <span class="n">angle</span> <span class="o">==</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="n">angle</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">90</span><span class="p">]</span>
			<span class="k">elif</span> <span class="n">angle</span> <span class="o">==</span> <span class="s1">&#39;z&#39;</span><span class="p">:</span> <span class="n">angle</span> <span class="o">=</span> <span class="p">[</span><span class="mi">90</span><span class="p">,</span><span class="mi">90</span><span class="p">]</span>
			<span class="k">else</span><span class="p">:</span> <span class="k">return</span>
			<span class="n">face1</span> <span class="o">=</span> <span class="kc">True</span><span class="p">;</span> <span class="n">face2</span> <span class="o">=</span> <span class="kc">True</span><span class="p">;</span> <span class="n">face3</span> <span class="o">=</span> <span class="kc">True</span><span class="p">;</span> <span class="n">face4</span> <span class="o">=</span> <span class="kc">True</span><span class="p">;</span> <span class="n">face5</span> <span class="o">=</span> <span class="kc">True</span><span class="p">;</span> <span class="n">face6</span> <span class="o">=</span> <span class="kc">True</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">while</span> <span class="n">angle</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&lt;-</span><span class="mi">90</span><span class="p">:</span> <span class="n">angle</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+=</span><span class="mi">180</span>
			<span class="k">while</span> <span class="n">angle</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">90</span><span class="p">:</span> <span class="n">angle</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-=</span><span class="mi">180</span>
			<span class="k">while</span> <span class="n">angle</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">:</span> <span class="n">angle</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+=</span><span class="mi">180</span>
			<span class="k">while</span> <span class="n">angle</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">360</span><span class="p">:</span> <span class="n">angle</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-=</span><span class="mi">180</span>
			<span class="k">if</span> <span class="n">angle</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span> <span class="n">face1</span> <span class="o">=</span> <span class="kc">True</span><span class="p">;</span> <span class="n">face2</span> <span class="o">=</span> <span class="kc">False</span>
			<span class="k">else</span><span class="p">:</span> <span class="n">face1</span> <span class="o">=</span> <span class="kc">False</span><span class="p">;</span> <span class="n">face2</span> <span class="o">=</span> <span class="kc">True</span>
			<span class="k">if</span> <span class="n">angle</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">270</span> <span class="ow">or</span> <span class="n">angle</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">&lt;=</span><span class="mi">90</span><span class="p">:</span> <span class="n">face3</span> <span class="o">=</span> <span class="kc">True</span><span class="p">;</span> <span class="n">face4</span> <span class="o">=</span> <span class="kc">False</span>
			<span class="k">else</span><span class="p">:</span> <span class="n">face3</span> <span class="o">=</span> <span class="kc">False</span><span class="p">;</span> <span class="n">face4</span> <span class="o">=</span> <span class="kc">True</span>
			<span class="k">if</span> <span class="n">angle</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">0</span> <span class="ow">and</span> <span class="n">angle</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">&lt;=</span><span class="mi">180</span><span class="p">:</span> <span class="n">face5</span> <span class="o">=</span> <span class="kc">True</span><span class="p">;</span> <span class="n">face6</span> <span class="o">=</span> <span class="kc">False</span>
			<span class="k">else</span><span class="p">:</span> <span class="n">face5</span> <span class="o">=</span> <span class="kc">False</span><span class="p">;</span> <span class="n">face6</span> <span class="o">=</span> <span class="kc">True</span>
		<span class="c1"># plot bounding box</span>
		<span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
		<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mf">10.5</span><span class="p">,</span><span class="mf">8.275</span><span class="p">])</span>
		<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="s1">&#39;3d&#39;</span><span class="p">)</span>
		<span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">,</span> <span class="s1">&#39;datalim&#39;</span><span class="p">)</span>
		
		<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="n">font_size</span><span class="p">)</span>
		<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="n">font_size</span><span class="p">)</span>
		<span class="n">ax</span><span class="o">.</span><span class="n">set_zlabel</span><span class="p">(</span><span class="n">zlabel</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="n">font_size</span><span class="p">)</span>
		<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="n">font_size</span><span class="p">)</span>
		
		<span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">():</span>
			<span class="n">t</span><span class="o">.</span><span class="n">set_fontsize</span><span class="p">(</span><span class="n">font_size</span><span class="p">)</span>
		<span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_yticklabels</span><span class="p">():</span>
			<span class="n">t</span><span class="o">.</span><span class="n">set_fontsize</span><span class="p">(</span><span class="n">font_size</span><span class="p">)</span>
		<span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_zticklabels</span><span class="p">():</span>
			<span class="n">t</span><span class="o">.</span><span class="n">set_fontsize</span><span class="p">(</span><span class="n">font_size</span><span class="p">)</span>

		<span class="n">xmin</span><span class="p">,</span><span class="n">xmax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xmin</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">xmax</span>
		<span class="n">ymin</span><span class="p">,</span><span class="n">ymax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ymin</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ymax</span>
		<span class="n">zmin</span><span class="p">,</span><span class="n">zmax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">zmin</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">zmax</span>
		
		<span class="k">if</span> <span class="n">equal_axes</span><span class="p">:</span>
			<span class="n">MAX</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">([</span><span class="n">xmax</span><span class="o">-</span><span class="n">xmin</span><span class="p">,</span><span class="n">ymax</span><span class="o">-</span><span class="n">ymin</span><span class="p">,</span><span class="n">zmax</span><span class="o">-</span><span class="n">zmin</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span>
			<span class="n">C</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">xmin</span><span class="o">+</span><span class="n">xmax</span><span class="p">,</span><span class="n">ymin</span><span class="o">+</span><span class="n">ymax</span><span class="p">,</span><span class="n">zmin</span><span class="o">+</span><span class="n">zmax</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span>
			<span class="k">for</span> <span class="n">direction</span> <span class="ow">in</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
				<span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">direction</span> <span class="o">*</span> <span class="n">MAX</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])):</span>
					<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">point</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">C</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="p">[</span><span class="n">point</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">C</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="p">[</span><span class="n">point</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="n">C</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
		<span class="n">ax</span><span class="o">.</span><span class="n">view_init</span><span class="p">(</span><span class="n">angle</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">angle</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
		
		<span class="k">if</span> <span class="n">cutaway</span><span class="p">:</span> <span class="n">xmid</span><span class="p">,</span><span class="n">ymid</span><span class="p">,</span><span class="n">zmid</span> <span class="o">=</span> <span class="n">cutaway</span>
		<span class="k">else</span><span class="p">:</span> 
			<span class="k">if</span> <span class="n">face1</span><span class="p">:</span>
				<span class="k">if</span> <span class="n">face5</span><span class="p">:</span>
					<span class="k">if</span> <span class="n">face3</span><span class="p">:</span> <span class="n">xmid</span><span class="p">,</span><span class="n">ymid</span><span class="p">,</span><span class="n">zmid</span> <span class="o">=</span> <span class="n">xmax</span><span class="p">,</span><span class="n">ymax</span><span class="p">,</span><span class="n">zmax</span>
					<span class="k">else</span><span class="p">:</span> <span class="n">xmid</span><span class="p">,</span><span class="n">ymid</span><span class="p">,</span><span class="n">zmid</span> <span class="o">=</span> <span class="n">xmin</span><span class="p">,</span><span class="n">ymax</span><span class="p">,</span><span class="n">zmax</span>
				<span class="k">else</span><span class="p">:</span>
					<span class="k">if</span> <span class="n">face3</span><span class="p">:</span><span class="n">xmid</span><span class="p">,</span><span class="n">ymid</span><span class="p">,</span><span class="n">zmid</span> <span class="o">=</span> <span class="n">xmax</span><span class="p">,</span><span class="n">ymin</span><span class="p">,</span><span class="n">zmax</span>
					<span class="k">else</span><span class="p">:</span><span class="n">xmid</span><span class="p">,</span><span class="n">ymid</span><span class="p">,</span><span class="n">zmid</span> <span class="o">=</span> <span class="n">xmin</span><span class="p">,</span><span class="n">ymin</span><span class="p">,</span><span class="n">zmax</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="k">if</span> <span class="n">face5</span><span class="p">:</span>
					<span class="k">if</span> <span class="n">face3</span><span class="p">:</span> <span class="n">xmid</span><span class="p">,</span><span class="n">ymid</span><span class="p">,</span><span class="n">zmid</span> <span class="o">=</span> <span class="n">xmax</span><span class="p">,</span><span class="n">ymax</span><span class="p">,</span><span class="n">zmin</span>
					<span class="k">else</span><span class="p">:</span> <span class="n">xmid</span><span class="p">,</span><span class="n">ymid</span><span class="p">,</span><span class="n">zmid</span> <span class="o">=</span> <span class="n">xmin</span><span class="p">,</span><span class="n">ymax</span><span class="p">,</span><span class="n">zmin</span>
				<span class="k">else</span><span class="p">:</span>
					<span class="k">if</span> <span class="n">face3</span><span class="p">:</span><span class="n">xmid</span><span class="p">,</span><span class="n">ymid</span><span class="p">,</span><span class="n">zmid</span> <span class="o">=</span> <span class="n">xmax</span><span class="p">,</span><span class="n">ymin</span><span class="p">,</span><span class="n">zmin</span>
					<span class="k">else</span><span class="p">:</span><span class="n">xmid</span><span class="p">,</span><span class="n">ymid</span><span class="p">,</span><span class="n">zmid</span> <span class="o">=</span> <span class="n">xmin</span><span class="p">,</span><span class="n">ymin</span><span class="p">,</span><span class="n">zmin</span>
					
		<span class="n">p13</span> <span class="o">=</span> <span class="p">[</span><span class="n">xmid</span><span class="p">,</span><span class="n">ymid</span><span class="p">,</span><span class="n">zmid</span><span class="p">]</span>
		<span class="k">if</span> <span class="n">face1</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">face5</span><span class="p">:</span>
				<span class="k">if</span> <span class="n">face3</span><span class="p">:</span>					
					<span class="n">p1</span><span class="o">=</span><span class="p">[</span><span class="n">xmin</span><span class="p">,</span><span class="n">ymin</span><span class="p">,</span><span class="n">zmax</span><span class="p">];</span> <span class="n">p2</span><span class="o">=</span><span class="p">[</span><span class="n">xmin</span><span class="p">,</span><span class="n">ymax</span><span class="p">,</span><span class="n">zmax</span><span class="p">];</span> <span class="n">p3</span><span class="o">=</span><span class="p">[</span><span class="n">xmin</span><span class="p">,</span><span class="n">ymax</span><span class="p">,</span><span class="n">zmin</span><span class="p">];</span> <span class="n">p4</span><span class="o">=</span><span class="p">[</span><span class="n">xmax</span><span class="p">,</span><span class="n">ymax</span><span class="p">,</span><span class="n">zmin</span><span class="p">]</span>
					<span class="n">p5</span><span class="o">=</span><span class="p">[</span><span class="n">xmax</span><span class="p">,</span><span class="n">ymin</span><span class="p">,</span><span class="n">zmin</span><span class="p">];</span> <span class="n">p6</span><span class="o">=</span><span class="p">[</span><span class="n">xmax</span><span class="p">,</span><span class="n">ymin</span><span class="p">,</span><span class="n">zmax</span><span class="p">];</span> <span class="n">p7</span><span class="o">=</span><span class="p">[</span><span class="n">xmax</span><span class="p">,</span><span class="n">ymid</span><span class="p">,</span><span class="n">zmax</span><span class="p">];</span> <span class="n">p8</span><span class="o">=</span><span class="p">[</span><span class="n">xmid</span><span class="p">,</span><span class="n">ymid</span><span class="p">,</span><span class="n">zmax</span><span class="p">]</span>
					<span class="n">p9</span><span class="o">=</span><span class="p">[</span><span class="n">xmid</span><span class="p">,</span><span class="n">ymax</span><span class="p">,</span><span class="n">zmax</span><span class="p">];</span> <span class="n">p10</span><span class="o">=</span><span class="p">[</span><span class="n">xmid</span><span class="p">,</span><span class="n">ymax</span><span class="p">,</span><span class="n">zmid</span><span class="p">];</span> <span class="n">p11</span><span class="o">=</span><span class="p">[</span><span class="n">xmax</span><span class="p">,</span><span class="n">ymax</span><span class="p">,</span><span class="n">zmid</span><span class="p">];</span><span class="n">p12</span><span class="o">=</span><span class="p">[</span><span class="n">xmax</span><span class="p">,</span><span class="n">ymid</span><span class="p">,</span><span class="n">zmid</span><span class="p">]</span>
				<span class="k">else</span><span class="p">:</span>						
					<span class="n">p1</span><span class="o">=</span><span class="p">[</span><span class="n">xmax</span><span class="p">,</span><span class="n">ymin</span><span class="p">,</span><span class="n">zmax</span><span class="p">];</span> <span class="n">p2</span><span class="o">=</span><span class="p">[</span><span class="n">xmax</span><span class="p">,</span><span class="n">ymax</span><span class="p">,</span><span class="n">zmax</span><span class="p">];</span> <span class="n">p3</span><span class="o">=</span><span class="p">[</span><span class="n">xmax</span><span class="p">,</span><span class="n">ymax</span><span class="p">,</span><span class="n">zmin</span><span class="p">];</span> <span class="n">p4</span><span class="o">=</span><span class="p">[</span><span class="n">xmin</span><span class="p">,</span><span class="n">ymax</span><span class="p">,</span><span class="n">zmin</span><span class="p">]</span>
					<span class="n">p5</span><span class="o">=</span><span class="p">[</span><span class="n">xmin</span><span class="p">,</span><span class="n">ymin</span><span class="p">,</span><span class="n">zmin</span><span class="p">];</span> <span class="n">p6</span><span class="o">=</span><span class="p">[</span><span class="n">xmin</span><span class="p">,</span><span class="n">ymin</span><span class="p">,</span><span class="n">zmax</span><span class="p">];</span> <span class="n">p7</span><span class="o">=</span><span class="p">[</span><span class="n">xmin</span><span class="p">,</span><span class="n">ymid</span><span class="p">,</span><span class="n">zmax</span><span class="p">];</span> <span class="n">p8</span><span class="o">=</span><span class="p">[</span><span class="n">xmid</span><span class="p">,</span><span class="n">ymid</span><span class="p">,</span><span class="n">zmax</span><span class="p">]</span>
					<span class="n">p9</span><span class="o">=</span><span class="p">[</span><span class="n">xmid</span><span class="p">,</span><span class="n">ymax</span><span class="p">,</span><span class="n">zmax</span><span class="p">];</span> <span class="n">p10</span><span class="o">=</span><span class="p">[</span><span class="n">xmid</span><span class="p">,</span><span class="n">ymax</span><span class="p">,</span><span class="n">zmid</span><span class="p">];</span> <span class="n">p11</span><span class="o">=</span><span class="p">[</span><span class="n">xmin</span><span class="p">,</span><span class="n">ymax</span><span class="p">,</span><span class="n">zmid</span><span class="p">];</span><span class="n">p12</span><span class="o">=</span><span class="p">[</span><span class="n">xmin</span><span class="p">,</span><span class="n">ymid</span><span class="p">,</span><span class="n">zmid</span><span class="p">]</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="k">if</span> <span class="n">face3</span><span class="p">:</span>						
					<span class="n">p1</span><span class="o">=</span><span class="p">[</span><span class="n">xmin</span><span class="p">,</span><span class="n">ymax</span><span class="p">,</span><span class="n">zmax</span><span class="p">];</span> <span class="n">p2</span><span class="o">=</span><span class="p">[</span><span class="n">xmin</span><span class="p">,</span><span class="n">ymin</span><span class="p">,</span><span class="n">zmax</span><span class="p">];</span> <span class="n">p3</span><span class="o">=</span><span class="p">[</span><span class="n">xmin</span><span class="p">,</span><span class="n">ymin</span><span class="p">,</span><span class="n">zmin</span><span class="p">];</span> <span class="n">p4</span><span class="o">=</span><span class="p">[</span><span class="n">xmax</span><span class="p">,</span><span class="n">ymin</span><span class="p">,</span><span class="n">zmin</span><span class="p">]</span>
					<span class="n">p5</span><span class="o">=</span><span class="p">[</span><span class="n">xmax</span><span class="p">,</span><span class="n">ymax</span><span class="p">,</span><span class="n">zmin</span><span class="p">];</span> <span class="n">p6</span><span class="o">=</span><span class="p">[</span><span class="n">xmax</span><span class="p">,</span><span class="n">ymax</span><span class="p">,</span><span class="n">zmax</span><span class="p">];</span> <span class="n">p7</span><span class="o">=</span><span class="p">[</span><span class="n">xmax</span><span class="p">,</span><span class="n">ymid</span><span class="p">,</span><span class="n">zmax</span><span class="p">];</span> <span class="n">p8</span><span class="o">=</span><span class="p">[</span><span class="n">xmid</span><span class="p">,</span><span class="n">ymid</span><span class="p">,</span><span class="n">zmax</span><span class="p">]</span>
					<span class="n">p9</span><span class="o">=</span><span class="p">[</span><span class="n">xmid</span><span class="p">,</span><span class="n">ymin</span><span class="p">,</span><span class="n">zmax</span><span class="p">];</span> <span class="n">p10</span><span class="o">=</span><span class="p">[</span><span class="n">xmid</span><span class="p">,</span><span class="n">ymin</span><span class="p">,</span><span class="n">zmid</span><span class="p">];</span> <span class="n">p11</span><span class="o">=</span><span class="p">[</span><span class="n">xmax</span><span class="p">,</span><span class="n">ymin</span><span class="p">,</span><span class="n">zmid</span><span class="p">];</span><span class="n">p12</span><span class="o">=</span><span class="p">[</span><span class="n">xmax</span><span class="p">,</span><span class="n">ymid</span><span class="p">,</span><span class="n">zmid</span><span class="p">]</span>
				<span class="k">else</span><span class="p">:</span>		
					<span class="n">p1</span><span class="o">=</span><span class="p">[</span><span class="n">xmax</span><span class="p">,</span><span class="n">ymax</span><span class="p">,</span><span class="n">zmax</span><span class="p">];</span> <span class="n">p2</span><span class="o">=</span><span class="p">[</span><span class="n">xmax</span><span class="p">,</span><span class="n">ymin</span><span class="p">,</span><span class="n">zmax</span><span class="p">];</span> <span class="n">p3</span><span class="o">=</span><span class="p">[</span><span class="n">xmax</span><span class="p">,</span><span class="n">ymin</span><span class="p">,</span><span class="n">zmin</span><span class="p">];</span> <span class="n">p4</span><span class="o">=</span><span class="p">[</span><span class="n">xmin</span><span class="p">,</span><span class="n">ymin</span><span class="p">,</span><span class="n">zmin</span><span class="p">]</span>
					<span class="n">p5</span><span class="o">=</span><span class="p">[</span><span class="n">xmin</span><span class="p">,</span><span class="n">ymax</span><span class="p">,</span><span class="n">zmin</span><span class="p">];</span> <span class="n">p6</span><span class="o">=</span><span class="p">[</span><span class="n">xmin</span><span class="p">,</span><span class="n">ymax</span><span class="p">,</span><span class="n">zmax</span><span class="p">];</span> <span class="n">p7</span><span class="o">=</span><span class="p">[</span><span class="n">xmin</span><span class="p">,</span><span class="n">ymid</span><span class="p">,</span><span class="n">zmax</span><span class="p">];</span> <span class="n">p8</span><span class="o">=</span><span class="p">[</span><span class="n">xmid</span><span class="p">,</span><span class="n">ymid</span><span class="p">,</span><span class="n">zmax</span><span class="p">]</span>
					<span class="n">p9</span><span class="o">=</span><span class="p">[</span><span class="n">xmid</span><span class="p">,</span><span class="n">ymin</span><span class="p">,</span><span class="n">zmax</span><span class="p">];</span> <span class="n">p10</span><span class="o">=</span><span class="p">[</span><span class="n">xmid</span><span class="p">,</span><span class="n">ymin</span><span class="p">,</span><span class="n">zmid</span><span class="p">];</span> <span class="n">p11</span><span class="o">=</span><span class="p">[</span><span class="n">xmin</span><span class="p">,</span><span class="n">ymin</span><span class="p">,</span><span class="n">zmid</span><span class="p">];</span><span class="n">p12</span><span class="o">=</span><span class="p">[</span><span class="n">xmin</span><span class="p">,</span><span class="n">ymid</span><span class="p">,</span><span class="n">zmid</span><span class="p">]</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">face5</span><span class="p">:</span>
				<span class="k">if</span> <span class="n">face3</span><span class="p">:</span>					
					<span class="n">p1</span><span class="o">=</span><span class="p">[</span><span class="n">xmin</span><span class="p">,</span><span class="n">ymin</span><span class="p">,</span><span class="n">zmin</span><span class="p">];</span> <span class="n">p2</span><span class="o">=</span><span class="p">[</span><span class="n">xmin</span><span class="p">,</span><span class="n">ymax</span><span class="p">,</span><span class="n">zmin</span><span class="p">];</span> <span class="n">p3</span><span class="o">=</span><span class="p">[</span><span class="n">xmin</span><span class="p">,</span><span class="n">ymax</span><span class="p">,</span><span class="n">zmax</span><span class="p">];</span> <span class="n">p4</span><span class="o">=</span><span class="p">[</span><span class="n">xmax</span><span class="p">,</span><span class="n">ymax</span><span class="p">,</span><span class="n">zmax</span><span class="p">]</span>
					<span class="n">p5</span><span class="o">=</span><span class="p">[</span><span class="n">xmax</span><span class="p">,</span><span class="n">ymin</span><span class="p">,</span><span class="n">zmax</span><span class="p">];</span> <span class="n">p6</span><span class="o">=</span><span class="p">[</span><span class="n">xmax</span><span class="p">,</span><span class="n">ymin</span><span class="p">,</span><span class="n">zmin</span><span class="p">];</span> <span class="n">p7</span><span class="o">=</span><span class="p">[</span><span class="n">xmax</span><span class="p">,</span><span class="n">ymid</span><span class="p">,</span><span class="n">zmin</span><span class="p">];</span> <span class="n">p8</span><span class="o">=</span><span class="p">[</span><span class="n">xmid</span><span class="p">,</span><span class="n">ymid</span><span class="p">,</span><span class="n">zmin</span><span class="p">]</span>
					<span class="n">p9</span><span class="o">=</span><span class="p">[</span><span class="n">xmid</span><span class="p">,</span><span class="n">ymax</span><span class="p">,</span><span class="n">zmin</span><span class="p">];</span> <span class="n">p10</span><span class="o">=</span><span class="p">[</span><span class="n">xmid</span><span class="p">,</span><span class="n">ymax</span><span class="p">,</span><span class="n">zmid</span><span class="p">];</span> <span class="n">p11</span><span class="o">=</span><span class="p">[</span><span class="n">xmax</span><span class="p">,</span><span class="n">ymax</span><span class="p">,</span><span class="n">zmid</span><span class="p">];</span><span class="n">p12</span><span class="o">=</span><span class="p">[</span><span class="n">xmax</span><span class="p">,</span><span class="n">ymid</span><span class="p">,</span><span class="n">zmid</span><span class="p">]</span>
				<span class="k">else</span><span class="p">:</span>						
					<span class="n">p1</span><span class="o">=</span><span class="p">[</span><span class="n">xmax</span><span class="p">,</span><span class="n">ymin</span><span class="p">,</span><span class="n">zmin</span><span class="p">];</span> <span class="n">p2</span><span class="o">=</span><span class="p">[</span><span class="n">xmax</span><span class="p">,</span><span class="n">ymax</span><span class="p">,</span><span class="n">zmin</span><span class="p">];</span> <span class="n">p3</span><span class="o">=</span><span class="p">[</span><span class="n">xmax</span><span class="p">,</span><span class="n">ymax</span><span class="p">,</span><span class="n">zmax</span><span class="p">];</span> <span class="n">p4</span><span class="o">=</span><span class="p">[</span><span class="n">xmin</span><span class="p">,</span><span class="n">ymax</span><span class="p">,</span><span class="n">zmax</span><span class="p">]</span>
					<span class="n">p5</span><span class="o">=</span><span class="p">[</span><span class="n">xmin</span><span class="p">,</span><span class="n">ymin</span><span class="p">,</span><span class="n">zmax</span><span class="p">];</span> <span class="n">p6</span><span class="o">=</span><span class="p">[</span><span class="n">xmin</span><span class="p">,</span><span class="n">ymin</span><span class="p">,</span><span class="n">zmin</span><span class="p">];</span> <span class="n">p7</span><span class="o">=</span><span class="p">[</span><span class="n">xmin</span><span class="p">,</span><span class="n">ymid</span><span class="p">,</span><span class="n">zmin</span><span class="p">];</span> <span class="n">p8</span><span class="o">=</span><span class="p">[</span><span class="n">xmid</span><span class="p">,</span><span class="n">ymid</span><span class="p">,</span><span class="n">zmin</span><span class="p">]</span>
					<span class="n">p9</span><span class="o">=</span><span class="p">[</span><span class="n">xmid</span><span class="p">,</span><span class="n">ymax</span><span class="p">,</span><span class="n">zmin</span><span class="p">];</span> <span class="n">p10</span><span class="o">=</span><span class="p">[</span><span class="n">xmid</span><span class="p">,</span><span class="n">ymax</span><span class="p">,</span><span class="n">zmid</span><span class="p">];</span> <span class="n">p11</span><span class="o">=</span><span class="p">[</span><span class="n">xmin</span><span class="p">,</span><span class="n">ymax</span><span class="p">,</span><span class="n">zmid</span><span class="p">];</span><span class="n">p12</span><span class="o">=</span><span class="p">[</span><span class="n">xmin</span><span class="p">,</span><span class="n">ymid</span><span class="p">,</span><span class="n">zmid</span><span class="p">]</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="k">if</span> <span class="n">face3</span><span class="p">:</span>						
					<span class="n">p1</span><span class="o">=</span><span class="p">[</span><span class="n">xmin</span><span class="p">,</span><span class="n">ymax</span><span class="p">,</span><span class="n">zmin</span><span class="p">];</span> <span class="n">p2</span><span class="o">=</span><span class="p">[</span><span class="n">xmin</span><span class="p">,</span><span class="n">ymin</span><span class="p">,</span><span class="n">zmin</span><span class="p">];</span> <span class="n">p3</span><span class="o">=</span><span class="p">[</span><span class="n">xmin</span><span class="p">,</span><span class="n">ymin</span><span class="p">,</span><span class="n">zmax</span><span class="p">];</span> <span class="n">p4</span><span class="o">=</span><span class="p">[</span><span class="n">xmax</span><span class="p">,</span><span class="n">ymin</span><span class="p">,</span><span class="n">zmax</span><span class="p">]</span>
					<span class="n">p5</span><span class="o">=</span><span class="p">[</span><span class="n">xmax</span><span class="p">,</span><span class="n">ymax</span><span class="p">,</span><span class="n">zmax</span><span class="p">];</span> <span class="n">p6</span><span class="o">=</span><span class="p">[</span><span class="n">xmax</span><span class="p">,</span><span class="n">ymax</span><span class="p">,</span><span class="n">zmin</span><span class="p">];</span> <span class="n">p7</span><span class="o">=</span><span class="p">[</span><span class="n">xmax</span><span class="p">,</span><span class="n">ymid</span><span class="p">,</span><span class="n">zmin</span><span class="p">];</span> <span class="n">p8</span><span class="o">=</span><span class="p">[</span><span class="n">xmid</span><span class="p">,</span><span class="n">ymid</span><span class="p">,</span><span class="n">zmin</span><span class="p">]</span>
					<span class="n">p9</span><span class="o">=</span><span class="p">[</span><span class="n">xmid</span><span class="p">,</span><span class="n">ymin</span><span class="p">,</span><span class="n">zmin</span><span class="p">];</span> <span class="n">p10</span><span class="o">=</span><span class="p">[</span><span class="n">xmid</span><span class="p">,</span><span class="n">ymin</span><span class="p">,</span><span class="n">zmid</span><span class="p">];</span> <span class="n">p11</span><span class="o">=</span><span class="p">[</span><span class="n">xmax</span><span class="p">,</span><span class="n">ymin</span><span class="p">,</span><span class="n">zmid</span><span class="p">];</span><span class="n">p12</span><span class="o">=</span><span class="p">[</span><span class="n">xmax</span><span class="p">,</span><span class="n">ymid</span><span class="p">,</span><span class="n">zmid</span><span class="p">]</span>
				<span class="k">else</span><span class="p">:</span>		
					<span class="n">p1</span><span class="o">=</span><span class="p">[</span><span class="n">xmax</span><span class="p">,</span><span class="n">ymax</span><span class="p">,</span><span class="n">zmin</span><span class="p">];</span> <span class="n">p2</span><span class="o">=</span><span class="p">[</span><span class="n">xmax</span><span class="p">,</span><span class="n">ymin</span><span class="p">,</span><span class="n">zmin</span><span class="p">];</span> <span class="n">p3</span><span class="o">=</span><span class="p">[</span><span class="n">xmax</span><span class="p">,</span><span class="n">ymin</span><span class="p">,</span><span class="n">zmax</span><span class="p">];</span> <span class="n">p4</span><span class="o">=</span><span class="p">[</span><span class="n">xmin</span><span class="p">,</span><span class="n">ymin</span><span class="p">,</span><span class="n">zmax</span><span class="p">]</span>
					<span class="n">p5</span><span class="o">=</span><span class="p">[</span><span class="n">xmin</span><span class="p">,</span><span class="n">ymax</span><span class="p">,</span><span class="n">zmax</span><span class="p">];</span> <span class="n">p6</span><span class="o">=</span><span class="p">[</span><span class="n">xmin</span><span class="p">,</span><span class="n">ymax</span><span class="p">,</span><span class="n">zmin</span><span class="p">];</span> <span class="n">p7</span><span class="o">=</span><span class="p">[</span><span class="n">xmin</span><span class="p">,</span><span class="n">ymid</span><span class="p">,</span><span class="n">zmin</span><span class="p">];</span> <span class="n">p8</span><span class="o">=</span><span class="p">[</span><span class="n">xmid</span><span class="p">,</span><span class="n">ymid</span><span class="p">,</span><span class="n">zmin</span><span class="p">]</span>
					<span class="n">p9</span><span class="o">=</span><span class="p">[</span><span class="n">xmid</span><span class="p">,</span><span class="n">ymin</span><span class="p">,</span><span class="n">zmin</span><span class="p">];</span> <span class="n">p10</span><span class="o">=</span><span class="p">[</span><span class="n">xmid</span><span class="p">,</span><span class="n">ymin</span><span class="p">,</span><span class="n">zmid</span><span class="p">];</span> <span class="n">p11</span><span class="o">=</span><span class="p">[</span><span class="n">xmin</span><span class="p">,</span><span class="n">ymin</span><span class="p">,</span><span class="n">zmid</span><span class="p">];</span><span class="n">p12</span><span class="o">=</span><span class="p">[</span><span class="n">xmin</span><span class="p">,</span><span class="n">ymid</span><span class="p">,</span><span class="n">zmid</span><span class="p">]</span>
		<span class="n">pt1</span><span class="o">=</span><span class="n">p1</span><span class="p">;</span><span class="n">pt2</span><span class="o">=</span><span class="n">p2</span><span class="p">;</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">pt1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">pt2</span><span class="p">[</span><span class="mi">0</span><span class="p">]],[</span><span class="n">pt1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">pt2</span><span class="p">[</span><span class="mi">1</span><span class="p">]],[</span><span class="n">pt1</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">pt2</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span><span class="s1">&#39;k-&#39;</span><span class="p">)</span>
		<span class="n">pt1</span><span class="o">=</span><span class="n">p9</span><span class="p">;</span><span class="n">pt2</span><span class="o">=</span><span class="n">p2</span><span class="p">;</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">pt1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">pt2</span><span class="p">[</span><span class="mi">0</span><span class="p">]],[</span><span class="n">pt1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">pt2</span><span class="p">[</span><span class="mi">1</span><span class="p">]],[</span><span class="n">pt1</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">pt2</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span><span class="s1">&#39;k-&#39;</span><span class="p">)</span>
		<span class="n">pt1</span><span class="o">=</span><span class="n">p3</span><span class="p">;</span><span class="n">pt2</span><span class="o">=</span><span class="n">p2</span><span class="p">;</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">pt1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">pt2</span><span class="p">[</span><span class="mi">0</span><span class="p">]],[</span><span class="n">pt1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">pt2</span><span class="p">[</span><span class="mi">1</span><span class="p">]],[</span><span class="n">pt1</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">pt2</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span><span class="s1">&#39;k-&#39;</span><span class="p">)</span>
		<span class="n">pt1</span><span class="o">=</span><span class="n">p3</span><span class="p">;</span><span class="n">pt2</span><span class="o">=</span><span class="n">p4</span><span class="p">;</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">pt1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">pt2</span><span class="p">[</span><span class="mi">0</span><span class="p">]],[</span><span class="n">pt1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">pt2</span><span class="p">[</span><span class="mi">1</span><span class="p">]],[</span><span class="n">pt1</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">pt2</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span><span class="s1">&#39;k-&#39;</span><span class="p">)</span>
		<span class="n">pt1</span><span class="o">=</span><span class="n">p11</span><span class="p">;</span><span class="n">pt2</span><span class="o">=</span><span class="n">p4</span><span class="p">;</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">pt1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">pt2</span><span class="p">[</span><span class="mi">0</span><span class="p">]],[</span><span class="n">pt1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">pt2</span><span class="p">[</span><span class="mi">1</span><span class="p">]],[</span><span class="n">pt1</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">pt2</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span><span class="s1">&#39;k-&#39;</span><span class="p">)</span>
		<span class="n">pt1</span><span class="o">=</span><span class="n">p5</span><span class="p">;</span><span class="n">pt2</span><span class="o">=</span><span class="n">p4</span><span class="p">;</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">pt1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">pt2</span><span class="p">[</span><span class="mi">0</span><span class="p">]],[</span><span class="n">pt1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">pt2</span><span class="p">[</span><span class="mi">1</span><span class="p">]],[</span><span class="n">pt1</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">pt2</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span><span class="s1">&#39;k-&#39;</span><span class="p">)</span>
		<span class="n">pt1</span><span class="o">=</span><span class="n">p5</span><span class="p">;</span><span class="n">pt2</span><span class="o">=</span><span class="n">p6</span><span class="p">;</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">pt1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">pt2</span><span class="p">[</span><span class="mi">0</span><span class="p">]],[</span><span class="n">pt1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">pt2</span><span class="p">[</span><span class="mi">1</span><span class="p">]],[</span><span class="n">pt1</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">pt2</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span><span class="s1">&#39;k-&#39;</span><span class="p">)</span>
		<span class="n">pt1</span><span class="o">=</span><span class="n">p1</span><span class="p">;</span><span class="n">pt2</span><span class="o">=</span><span class="n">p6</span><span class="p">;</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">pt1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">pt2</span><span class="p">[</span><span class="mi">0</span><span class="p">]],[</span><span class="n">pt1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">pt2</span><span class="p">[</span><span class="mi">1</span><span class="p">]],[</span><span class="n">pt1</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">pt2</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span><span class="s1">&#39;k-&#39;</span><span class="p">)</span>
		<span class="n">pt1</span><span class="o">=</span><span class="n">p7</span><span class="p">;</span><span class="n">pt2</span><span class="o">=</span><span class="n">p6</span><span class="p">;</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">pt1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">pt2</span><span class="p">[</span><span class="mi">0</span><span class="p">]],[</span><span class="n">pt1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">pt2</span><span class="p">[</span><span class="mi">1</span><span class="p">]],[</span><span class="n">pt1</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">pt2</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span><span class="s1">&#39;k-&#39;</span><span class="p">)</span>
		<span class="n">pt1</span><span class="o">=</span><span class="n">p7</span><span class="p">;</span><span class="n">pt2</span><span class="o">=</span><span class="n">p8</span><span class="p">;</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">pt1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">pt2</span><span class="p">[</span><span class="mi">0</span><span class="p">]],[</span><span class="n">pt1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">pt2</span><span class="p">[</span><span class="mi">1</span><span class="p">]],[</span><span class="n">pt1</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">pt2</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span><span class="s1">&#39;k-&#39;</span><span class="p">)</span>
		<span class="n">pt1</span><span class="o">=</span><span class="n">p7</span><span class="p">;</span><span class="n">pt2</span><span class="o">=</span><span class="n">p12</span><span class="p">;</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">pt1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">pt2</span><span class="p">[</span><span class="mi">0</span><span class="p">]],[</span><span class="n">pt1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">pt2</span><span class="p">[</span><span class="mi">1</span><span class="p">]],[</span><span class="n">pt1</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">pt2</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span><span class="s1">&#39;k-&#39;</span><span class="p">)</span>
		<span class="n">pt1</span><span class="o">=</span><span class="n">p11</span><span class="p">;</span><span class="n">pt2</span><span class="o">=</span><span class="n">p12</span><span class="p">;</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">pt1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">pt2</span><span class="p">[</span><span class="mi">0</span><span class="p">]],[</span><span class="n">pt1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">pt2</span><span class="p">[</span><span class="mi">1</span><span class="p">]],[</span><span class="n">pt1</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">pt2</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span><span class="s1">&#39;k-&#39;</span><span class="p">)</span>
		<span class="n">pt1</span><span class="o">=</span><span class="n">p13</span><span class="p">;</span><span class="n">pt2</span><span class="o">=</span><span class="n">p12</span><span class="p">;</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">pt1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">pt2</span><span class="p">[</span><span class="mi">0</span><span class="p">]],[</span><span class="n">pt1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">pt2</span><span class="p">[</span><span class="mi">1</span><span class="p">]],[</span><span class="n">pt1</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">pt2</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span><span class="s1">&#39;k-&#39;</span><span class="p">)</span>
		<span class="n">pt1</span><span class="o">=</span><span class="n">p13</span><span class="p">;</span><span class="n">pt2</span><span class="o">=</span><span class="n">p8</span><span class="p">;</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">pt1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">pt2</span><span class="p">[</span><span class="mi">0</span><span class="p">]],[</span><span class="n">pt1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">pt2</span><span class="p">[</span><span class="mi">1</span><span class="p">]],[</span><span class="n">pt1</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">pt2</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span><span class="s1">&#39;k-&#39;</span><span class="p">)</span>
		<span class="n">pt1</span><span class="o">=</span><span class="n">p13</span><span class="p">;</span><span class="n">pt2</span><span class="o">=</span><span class="n">p10</span><span class="p">;</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">pt1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">pt2</span><span class="p">[</span><span class="mi">0</span><span class="p">]],[</span><span class="n">pt1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">pt2</span><span class="p">[</span><span class="mi">1</span><span class="p">]],[</span><span class="n">pt1</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">pt2</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span><span class="s1">&#39;k-&#39;</span><span class="p">)</span>
		<span class="n">pt1</span><span class="o">=</span><span class="n">p9</span><span class="p">;</span><span class="n">pt2</span><span class="o">=</span><span class="n">p8</span><span class="p">;</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">pt1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">pt2</span><span class="p">[</span><span class="mi">0</span><span class="p">]],[</span><span class="n">pt1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">pt2</span><span class="p">[</span><span class="mi">1</span><span class="p">]],[</span><span class="n">pt1</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">pt2</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span><span class="s1">&#39;k-&#39;</span><span class="p">)</span>
		<span class="n">pt1</span><span class="o">=</span><span class="n">p9</span><span class="p">;</span><span class="n">pt2</span><span class="o">=</span><span class="n">p10</span><span class="p">;</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">pt1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">pt2</span><span class="p">[</span><span class="mi">0</span><span class="p">]],[</span><span class="n">pt1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">pt2</span><span class="p">[</span><span class="mi">1</span><span class="p">]],[</span><span class="n">pt1</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">pt2</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span><span class="s1">&#39;k-&#39;</span><span class="p">)</span>
		<span class="n">pt1</span><span class="o">=</span><span class="n">p11</span><span class="p">;</span><span class="n">pt2</span><span class="o">=</span><span class="n">p10</span><span class="p">;</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">pt1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">pt2</span><span class="p">[</span><span class="mi">0</span><span class="p">]],[</span><span class="n">pt1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">pt2</span><span class="p">[</span><span class="mi">1</span><span class="p">]],[</span><span class="n">pt1</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">pt2</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span><span class="s1">&#39;k-&#39;</span><span class="p">)</span>
					
		<span class="c1"># minor lines</span>
		<span class="n">xs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">([</span><span class="n">nd</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">nd</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodelist</span><span class="p">])</span>
		<span class="n">ys</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">([</span><span class="n">nd</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">nd</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodelist</span><span class="p">])</span>
		<span class="n">zs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">([</span><span class="n">nd</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">nd</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodelist</span><span class="p">])</span>
		
		<span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">xs</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">x</span><span class="o">&gt;=</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">([</span><span class="n">p2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">p9</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span> <span class="ow">and</span> <span class="n">x</span><span class="o">&lt;=</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">([</span><span class="n">p2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">p9</span><span class="p">[</span><span class="mi">0</span><span class="p">]]):</span>
				<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">x</span><span class="p">,</span><span class="n">x</span><span class="p">],[</span><span class="n">p1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">p2</span><span class="p">[</span><span class="mi">1</span><span class="p">]],[</span><span class="n">p2</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">p2</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span><span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
				<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">x</span><span class="p">,</span><span class="n">x</span><span class="p">],[</span><span class="n">p2</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">p2</span><span class="p">[</span><span class="mi">1</span><span class="p">]],[</span><span class="n">p2</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">p3</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span><span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">x</span><span class="p">,</span><span class="n">x</span><span class="p">],[</span><span class="n">p12</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">p2</span><span class="p">[</span><span class="mi">1</span><span class="p">]],[</span><span class="n">p10</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">p10</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span><span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
				<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">x</span><span class="p">,</span><span class="n">x</span><span class="p">],[</span><span class="n">p12</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">p6</span><span class="p">[</span><span class="mi">1</span><span class="p">]],[</span><span class="n">p2</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">p2</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span><span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>				
				<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">x</span><span class="p">,</span><span class="n">x</span><span class="p">],[</span><span class="n">p7</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">p7</span><span class="p">[</span><span class="mi">1</span><span class="p">]],[</span><span class="n">p7</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">p11</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span><span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
				<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">x</span><span class="p">,</span><span class="n">x</span><span class="p">],[</span><span class="n">p11</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">p11</span><span class="p">[</span><span class="mi">1</span><span class="p">]],[</span><span class="n">p11</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">p3</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span><span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
		<span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">ys</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">y</span><span class="o">&gt;=</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">([</span><span class="n">p6</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">p7</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span> <span class="ow">and</span> <span class="n">y</span><span class="o">&lt;=</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">([</span><span class="n">p6</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">p7</span><span class="p">[</span><span class="mi">1</span><span class="p">]]):</span>
				<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">p6</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">p1</span><span class="p">[</span><span class="mi">0</span><span class="p">]],[</span><span class="n">y</span><span class="p">,</span><span class="n">y</span><span class="p">],[</span><span class="n">p2</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">p2</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span><span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>				
				<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">p6</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">p6</span><span class="p">[</span><span class="mi">0</span><span class="p">]],[</span><span class="n">y</span><span class="p">,</span><span class="n">y</span><span class="p">],[</span><span class="n">p2</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">p3</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span><span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
			<span class="k">else</span><span class="p">:</span>             
				<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">p10</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">p11</span><span class="p">[</span><span class="mi">0</span><span class="p">]],[</span><span class="n">y</span><span class="p">,</span><span class="n">y</span><span class="p">],[</span><span class="n">p10</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">p10</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span><span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
				<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">p9</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">p2</span><span class="p">[</span><span class="mi">0</span><span class="p">]],[</span><span class="n">y</span><span class="p">,</span><span class="n">y</span><span class="p">],[</span><span class="n">p2</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">p2</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span><span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>							
				<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">p4</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">p4</span><span class="p">[</span><span class="mi">0</span><span class="p">]],[</span><span class="n">y</span><span class="p">,</span><span class="n">y</span><span class="p">],[</span><span class="n">p4</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">p11</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span><span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
				<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">p10</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">p10</span><span class="p">[</span><span class="mi">0</span><span class="p">]],[</span><span class="n">y</span><span class="p">,</span><span class="n">y</span><span class="p">],[</span><span class="n">p10</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">p9</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span><span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
		<span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">zs</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">z</span><span class="o">&gt;=</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">([</span><span class="n">p4</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">p11</span><span class="p">[</span><span class="mi">2</span><span class="p">]])</span> <span class="ow">and</span> <span class="n">z</span><span class="o">&lt;=</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">([</span><span class="n">p4</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">p11</span><span class="p">[</span><span class="mi">2</span><span class="p">]]):</span>
				<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">p4</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">p4</span><span class="p">[</span><span class="mi">0</span><span class="p">]],[</span><span class="n">p5</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">p4</span><span class="p">[</span><span class="mi">1</span><span class="p">]],[</span><span class="n">z</span><span class="p">,</span><span class="n">z</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>				
				<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">p4</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">p3</span><span class="p">[</span><span class="mi">0</span><span class="p">]],[</span><span class="n">p4</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">p4</span><span class="p">[</span><span class="mi">1</span><span class="p">]],[</span><span class="n">z</span><span class="p">,</span><span class="n">z</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">p4</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">p4</span><span class="p">[</span><span class="mi">0</span><span class="p">]],[</span><span class="n">p6</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">p7</span><span class="p">[</span><span class="mi">1</span><span class="p">]],[</span><span class="n">z</span><span class="p">,</span><span class="n">z</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>			
				<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">p10</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">p10</span><span class="p">[</span><span class="mi">0</span><span class="p">]],[</span><span class="n">p7</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">p11</span><span class="p">[</span><span class="mi">1</span><span class="p">]],[</span><span class="n">z</span><span class="p">,</span><span class="n">z</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>						
				<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">p2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">p8</span><span class="p">[</span><span class="mi">0</span><span class="p">]],[</span><span class="n">p4</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">p4</span><span class="p">[</span><span class="mi">1</span><span class="p">]],[</span><span class="n">z</span><span class="p">,</span><span class="n">z</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>				
				<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">p7</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">p8</span><span class="p">[</span><span class="mi">0</span><span class="p">]],[</span><span class="n">p7</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">p7</span><span class="p">[</span><span class="mi">1</span><span class="p">]],[</span><span class="n">z</span><span class="p">,</span><span class="n">z</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>				
		
		<span class="n">extension</span><span class="p">,</span> <span class="n">save_fname</span><span class="p">,</span> <span class="n">pdf</span> <span class="o">=</span> <span class="n">save_name</span><span class="p">(</span><span class="n">save</span><span class="p">,</span><span class="n">variable</span><span class="o">=</span><span class="s1">&#39;grid&#39;</span><span class="p">,</span><span class="n">time</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="p">:</span>
			<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">work_dir</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">work_dir</span><span class="p">):</span> 
				<span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">work_dir</span><span class="p">)</span>
			<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">work_dir</span><span class="p">:</span>
				<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">work_dir</span><span class="o">+</span><span class="n">slash</span><span class="o">+</span><span class="n">save_fname</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span><span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;portrait&#39;</span><span class="p">,</span> 
					<span class="nb">format</span><span class="o">=</span><span class="n">extension</span><span class="p">,</span><span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">pad_inches</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">save_fname</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span><span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;portrait&#39;</span><span class="p">,</span> 
					<span class="nb">format</span><span class="o">=</span><span class="n">extension</span><span class="p">,</span><span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">pad_inches</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">save_fname</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span><span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;portrait&#39;</span><span class="p">,</span> 
				<span class="nb">format</span><span class="o">=</span><span class="n">extension</span><span class="p">,</span><span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">pad_inches</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">pdf</span><span class="p">:</span> 
			<span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s1">&#39;epstopdf &#39;</span> <span class="o">+</span> <span class="n">save_fname</span><span class="p">)</span>
			<span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">save_fname</span><span class="p">)</span>			</div>
	<span class="k">def</span> <span class="nf">add_nodetree</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">repair</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot; Constuct octree for node positions. Call to update if changes made to grid.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_octree</span><span class="o">=</span><span class="n">octree</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bounding_box</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">nodelist</span><span class="p">,</span><span class="n">repair</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>	
	<span class="k">def</span> <span class="nf">_summary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>		
		<span class="n">L</span> <span class="o">=</span> <span class="mi">62</span>
		<span class="nb">print</span> <span class="s1">&#39;&#39;</span>
		<span class="nb">print</span> <span class="s1">&#39; ####---------------------------------------------------------####&#39;</span>
		<span class="n">line</span> <span class="o">=</span> <span class="s1">&#39; #### FEHM grid file </span><span class="se">\&#39;</span><span class="s1">&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\&#39;</span><span class="s1"> summary.&#39;</span>
		<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">L</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)):</span> <span class="n">line</span> <span class="o">+=</span> <span class="s1">&#39; &#39;</span>
		<span class="nb">print</span> <span class="n">line</span><span class="o">+</span><span class="s1">&#39;####&#39;</span>
		<span class="nb">print</span> <span class="s1">&#39; ####---------------------------------------------------------####&#39;</span>
		
		<span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39; #### Domain extent:&#39;</span><span class="p">)</span>
		<span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;x = [&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xmin</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;, &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xmax</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;]&#39;</span><span class="p">)</span>		
		<span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;y = [&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ymin</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;, &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ymax</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;]&#39;</span><span class="p">)</span>
		<span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;z = [&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zmin</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;, &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zmax</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;]&#39;</span><span class="p">)</span>
		<span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39; #### Statistics:&#39;</span><span class="p">)</span>
		<span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;nodes = &#39;</span> <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">number_nodes</span><span class="p">))</span>
		<span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;elements = &#39;</span> <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">number_elems</span><span class="p">))</span>
		
		<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39; ##&#39;</span><span class="p">):</span>
				<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">L</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)):</span> <span class="n">line</span> <span class="o">+=</span> <span class="s1">&#39; &#39;</span>
				<span class="nb">print</span> <span class="n">line</span><span class="o">+</span><span class="s1">&#39;####&#39;</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">prntStr</span> <span class="o">=</span> <span class="s1">&#39; #### -&#39;</span>
				<span class="n">keepGoing</span> <span class="o">=</span> <span class="kc">True</span>
				<span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
				<span class="k">while</span> <span class="n">keepGoing</span><span class="p">:</span>
					<span class="k">if</span> <span class="ow">not</span> <span class="n">line</span><span class="p">:</span> 
						<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">L</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">prntStr</span><span class="p">)):</span> <span class="n">prntStr</span> <span class="o">+=</span> <span class="s1">&#39; &#39;</span>
						<span class="nb">print</span> <span class="n">prntStr</span><span class="o">+</span><span class="s1">&#39;####&#39;</span>
						<span class="n">prntStr</span> <span class="o">=</span> <span class="s1">&#39; #### &#39;</span>
						<span class="k">break</span>
					<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">prntStr</span><span class="p">)</span><span class="o">&lt;</span><span class="p">(</span><span class="n">L</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">])):</span> 
						<span class="n">prntStr</span> <span class="o">+=</span> <span class="s1">&#39; &#39;</span><span class="o">+</span><span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
						<span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
					<span class="k">else</span><span class="p">:</span>
						<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">L</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">prntStr</span><span class="p">)):</span> <span class="n">prntStr</span> <span class="o">+=</span> <span class="s1">&#39; &#39;</span>
						<span class="nb">print</span> <span class="n">prntStr</span><span class="o">+</span><span class="s1">&#39;####&#39;</span>
						<span class="n">prntStr</span> <span class="o">=</span> <span class="s1">&#39; ####   &#39;</span>
		<span class="nb">print</span> <span class="s1">&#39; ####---------------------------------------------------------####&#39;</span>
		<span class="nb">print</span> <span class="s1">&#39;&#39;</span>
	<span class="k">def</span> <span class="nf">rotate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">angle</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span><span class="n">centre</span><span class="o">=</span><span class="p">[</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">]):</span>
		<span class="sd">&#39;&#39;&#39;Rotates the grid by some angle about a specified vertical axis.</span>
<span class="sd">		</span>
<span class="sd">		:param angle: Clockwise angle by which to rotate grid.</span>
<span class="sd">		:type angle: fl64</span>
<span class="sd">		:param centre: x and y coordinates of vertical axis about which to rotate. Alternatively, the centre of the computational domain can be specified by passing &#39;mid&#39;,&#39;middle&#39;,&#39;centre&#39;, or &#39;center&#39;.</span>
<span class="sd">		:type centre: [fl64,fl64], str</span>
<span class="sd">		&#39;&#39;&#39;</span>
		<span class="k">if</span> <span class="n">centre</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;middle&#39;</span><span class="p">,</span><span class="s1">&#39;mid&#39;</span><span class="p">,</span><span class="s1">&#39;centre&#39;</span><span class="p">,</span><span class="s1">&#39;center&#39;</span><span class="p">]:</span>
			<span class="n">centre</span> <span class="o">=</span> <span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">xmin</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">xmax</span><span class="p">)</span><span class="o">/</span><span class="mf">2.</span><span class="p">,(</span><span class="bp">self</span><span class="o">.</span><span class="n">ymin</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">ymax</span><span class="p">)</span><span class="o">/</span><span class="mf">2.</span><span class="p">]</span>
		<span class="k">for</span> <span class="n">nd</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodelist</span><span class="p">:</span>
			<span class="n">old_pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">nd</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">])</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">centre</span><span class="p">)</span> 	<span class="c1"># position relative to centre of rotation</span>
			<span class="n">theta_f</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">atan2</span><span class="p">(</span><span class="n">old_pos</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">old_pos</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="n">angle</span><span class="o">/</span><span class="mf">180.</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span>
			<span class="n">dist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">old_pos</span><span class="p">,</span><span class="n">old_pos</span><span class="p">))</span>
			<span class="n">new_pos</span> <span class="o">=</span> <span class="p">[</span><span class="n">dist</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta_f</span><span class="p">),</span><span class="n">dist</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta_f</span><span class="p">)]</span>
			<span class="n">nd</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">centre</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
			<span class="n">nd</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_pos</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">centre</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
	<span class="k">def</span> <span class="nf">get_bounding_box</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="n">minx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodelist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
		<span class="n">maxx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodelist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
		<span class="n">miny</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodelist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
		<span class="n">maxy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodelist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
		<span class="n">minz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodelist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
		<span class="n">maxz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodelist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
		<span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodelist</span><span class="p">:</span>
			<span class="n">pos</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">position</span>
			<span class="k">if</span> <span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&lt;</span><span class="n">minx</span><span class="p">:</span> <span class="n">minx</span> <span class="o">=</span> <span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
			<span class="k">if</span> <span class="n">pos</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">&lt;</span><span class="n">miny</span><span class="p">:</span> <span class="n">miny</span> <span class="o">=</span> <span class="n">pos</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
			<span class="k">if</span> <span class="n">pos</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">&lt;</span><span class="n">minz</span><span class="p">:</span> <span class="n">minz</span> <span class="o">=</span> <span class="n">pos</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
			<span class="k">if</span> <span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&gt;</span><span class="n">maxx</span><span class="p">:</span> <span class="n">maxx</span> <span class="o">=</span> <span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
			<span class="k">if</span> <span class="n">pos</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">&gt;</span><span class="n">maxy</span><span class="p">:</span> <span class="n">maxy</span> <span class="o">=</span> <span class="n">pos</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
			<span class="k">if</span> <span class="n">pos</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">&gt;</span><span class="n">maxz</span><span class="p">:</span> <span class="n">maxz</span> <span class="o">=</span> <span class="n">pos</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
		<span class="n">xr</span> <span class="o">=</span> <span class="n">maxx</span><span class="o">-</span><span class="n">minx</span><span class="o">+</span><span class="mf">1.</span><span class="p">;</span> <span class="n">yr</span> <span class="o">=</span> <span class="n">maxy</span><span class="o">-</span><span class="n">miny</span><span class="o">+</span><span class="mf">1.</span><span class="p">;</span> <span class="n">zr</span> <span class="o">=</span> <span class="n">maxz</span><span class="o">-</span><span class="n">minz</span><span class="o">+</span><span class="mf">1.</span><span class="p">;</span>
		
		<span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">minx</span><span class="o">+</span><span class="n">maxx</span><span class="p">,</span><span class="n">miny</span><span class="o">+</span><span class="n">maxy</span><span class="p">,</span><span class="n">minz</span><span class="o">+</span><span class="n">maxz</span><span class="p">])</span><span class="o">/</span><span class="mf">2.</span>
		
		<span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">([</span><span class="n">xr</span><span class="p">,</span><span class="n">yr</span><span class="p">,</span><span class="n">zr</span><span class="p">])</span>
		
		<span class="k">if</span> <span class="n">minx</span> <span class="o">==</span> <span class="n">maxx</span><span class="p">:</span>
			<span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">minx</span><span class="p">;</span> <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">r</span><span class="p">])</span>
			<span class="k">return</span> <span class="p">[</span><span class="n">c</span><span class="o">-</span><span class="mf">0.51</span><span class="o">*</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="o">+</span><span class="mf">0.51</span><span class="o">*</span><span class="n">r</span><span class="p">]</span>
		<span class="k">elif</span> <span class="n">miny</span> <span class="o">==</span> <span class="n">maxy</span><span class="p">:</span>
			<span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">miny</span><span class="p">;</span> <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">r</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">r</span><span class="p">])</span>
			<span class="k">return</span> <span class="p">[</span><span class="n">c</span><span class="o">-</span><span class="mf">0.51</span><span class="o">*</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="o">+</span><span class="mf">0.51</span><span class="o">*</span><span class="n">r</span><span class="p">]</span>
		<span class="k">elif</span> <span class="n">minz</span> <span class="o">==</span> <span class="n">maxz</span><span class="p">:</span>
			<span class="n">c</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">minz</span><span class="p">;</span> <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">r</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
			<span class="k">return</span> <span class="p">[</span><span class="n">c</span><span class="o">-</span><span class="mf">0.51</span><span class="o">*</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="o">+</span><span class="mf">0.51</span><span class="o">*</span><span class="n">r</span><span class="p">]</span>
		<span class="k">else</span><span class="p">:</span>			
			<span class="k">return</span> <span class="p">[</span><span class="n">c</span><span class="o">-</span><span class="mf">0.51</span><span class="o">*</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="o">+</span><span class="mf">0.51</span><span class="o">*</span><span class="n">r</span><span class="p">]</span>
	<span class="n">bounding_box</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">get_bounding_box</span><span class="p">)</span>	
	<span class="k">def</span> <span class="nf">_get_filename</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="o">.</span><span class="n">filename</span>
	<span class="n">filename</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_get_filename</span><span class="p">)</span><span class="c1">#: (*str*) Name of FEHM grid file.</span>
	<span class="k">def</span> <span class="nf">_get_node</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_node</span>
	<span class="n">node</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_get_node</span><span class="p">)</span><span class="c1">#: (*dict[fnode]*) Dictionary of grid nodes, indexed by node integer.</span>
	<span class="k">def</span> <span class="nf">_get_nodelist</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nodelist</span>
	<span class="n">nodelist</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_get_nodelist</span><span class="p">)</span><span class="c1">#: (*lst[fnode]*) List of all node objects in the grid.</span>
	<span class="k">def</span> <span class="nf">_get_elem</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_elem</span>
	<span class="n">elem</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_get_elem</span><span class="p">)</span><span class="c1">#: (*dict[felem]*) Dictionary of elements, indexed by element integer.</span>
	<span class="k">def</span> <span class="nf">_get_elemlist</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_elemlist</span>
	<span class="n">elemlist</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_get_elemlist</span><span class="p">)</span><span class="c1">#: (*lst[felem]*) List of all element objects in the grid.</span>
	<span class="k">def</span> <span class="nf">_get_conn</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_conn</span>
	<span class="n">conn</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_get_conn</span><span class="p">)</span><span class="c1">#: (*dict[fconn]*) Dictionary of connections, indexed by a two element tuple of the member node integers.</span>
	<span class="k">def</span> <span class="nf">_get_connlist</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_connlist</span>
	<span class="n">connlist</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_get_connlist</span><span class="p">)</span><span class="c1">#: (*lst[fconn]*) List of all connection objects in the grid.</span>
	<span class="k">def</span> <span class="nf">_get_dimensions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dimensions</span>
	<span class="n">dimensions</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_get_dimensions</span><span class="p">)</span> <span class="c1">#: (*int*) Dimensions of the grid.</span>
	<span class="k">def</span> <span class="nf">get_xmin</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">([</span><span class="n">nd</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">nd</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodelist</span><span class="p">])</span>
	<span class="n">xmin</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">get_xmin</span><span class="p">)</span> 				<span class="c1">#: Minimum x-coordinate for all nodes.</span>
	<span class="k">def</span> <span class="nf">get_xmax</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">([</span><span class="n">nd</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">nd</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodelist</span><span class="p">])</span>
	<span class="n">xmax</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">get_xmax</span><span class="p">)</span>				<span class="c1">#: Maximum x-coordinate for all nodes.</span>
	<span class="k">def</span> <span class="nf">get_ymin</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">([</span><span class="n">nd</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">nd</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodelist</span><span class="p">])</span>
	<span class="n">ymin</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">get_ymin</span><span class="p">)</span>				<span class="c1">#: Minimum y-coordinate for all nodes.</span>
	<span class="k">def</span> <span class="nf">get_ymax</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">([</span><span class="n">nd</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">nd</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodelist</span><span class="p">])</span>
	<span class="n">ymax</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">get_ymax</span><span class="p">)</span>				<span class="c1">#: Maximum y-coordinate for all nodes.</span>
	<span class="k">def</span> <span class="nf">get_zmin</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">([</span><span class="n">nd</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">nd</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodelist</span><span class="p">])</span>
	<span class="n">zmin</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">get_zmin</span><span class="p">)</span>				<span class="c1">#: Minimum z-coordinate for all nodes.</span>
	<span class="k">def</span> <span class="nf">get_zmax</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">([</span><span class="n">nd</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">nd</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodelist</span><span class="p">])</span>
	<span class="n">zmax</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">get_zmax</span><span class="p">)</span>				<span class="c1">#: Maximum z-coordinate for all nodes.</span>
	<span class="k">def</span> <span class="nf">get_node_number</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodelist</span><span class="p">)</span>
	<span class="n">number_nodes</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">get_node_number</span><span class="p">)</span><span class="c1">#: Number of nodes in grid.</span>
	<span class="k">def</span> <span class="nf">get_element_number</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">elemlist</span><span class="p">)</span>
	<span class="n">number_elems</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">get_element_number</span><span class="p">)</span><span class="c1">#: Number of elements in grid.</span>
	<span class="k">def</span> <span class="nf">_get_octree</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_octree</span>
	<span class="k">def</span> <span class="nf">_set_octree</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">value</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">_octree</span> <span class="o">=</span> <span class="n">value</span>
	<span class="n">octree</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_get_octree</span><span class="p">,</span> <span class="n">_set_octree</span><span class="p">)</span> <span class="c1">#: (*octree*) Octree object associated with the grid.</span>
	<span class="k">def</span> <span class="nf">get_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="nb">print</span> <span class="s1">&#39;FEHM grid file </span><span class="se">\&#39;</span><span class="s1">&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\&#39;</span><span class="s1"> summary.&#39;</span>
		<span class="nb">print</span> <span class="s1">&#39;Model domain: x = [&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xmin</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;, &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xmax</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;]&#39;</span>
		<span class="nb">print</span> <span class="s1">&#39;              y = [&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ymin</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;, &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ymax</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;]&#39;</span>
		<span class="nb">print</span> <span class="s1">&#39;              z = [&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zmin</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;, &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zmax</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;]&#39;</span>
		<span class="nb">print</span> <span class="s1">&#39;          nodes = &#39;</span> <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">number_nodes</span><span class="p">)</span>
		<span class="nb">print</span> <span class="s1">&#39;       elements = &#39;</span> <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">number_elems</span><span class="p">)</span>
		<span class="nb">print</span> <span class="s1">&#39; &#39;</span>
	<span class="n">what</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">get_info</span><span class="p">)</span> 				<span class="c1">#: Print to screen information about the grid.</span></div>
<span class="k">class</span> <span class="nc">fmake</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span> 				<span class="c1">#Rectilinear grid constructor.</span>
	<span class="sd">&quot;&quot;&quot;Generate an orthogonal mesh corresponding to vectors of nodal positions.</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">meshname</span><span class="p">,</span><span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">z</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_x</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_y</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_z</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">z</span><span class="p">))</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_dimension</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_meshname</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
		<span class="k">if</span> <span class="n">meshname</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meshname</span> <span class="o">=</span> <span class="n">meshname</span>
	<span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">meshname</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;Write out the grid file.</span>
<span class="sd">		</span>
<span class="sd">		:param meshname: Name of the grid file.</span>
<span class="sd">		:type meshname: str</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>
		<span class="k">if</span> <span class="n">meshname</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meshname</span> <span class="o">=</span> <span class="n">meshname</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">meshname</span><span class="o">==</span><span class="s1">&#39;&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meshname</span><span class="o">=</span><span class="s1">&#39;default_GRID.inp&#39;</span>
		
		<span class="n">temp_path</span> <span class="o">=</span> <span class="n">fpath</span><span class="p">()</span>
		<span class="n">temp_path</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meshname</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">temp_path</span><span class="o">.</span><span class="n">absolute_to_file</span><span class="p">)</span>
		<span class="k">except</span><span class="p">:</span>
			<span class="k">pass</span>		
		<span class="n">outfile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">temp_path</span><span class="o">.</span><span class="n">full_path</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
		
		<span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;coor</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
		<span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;   &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodelist</span><span class="p">))</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
		<span class="k">for</span> <span class="n">nd</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodelist</span><span class="p">:</span> 
			<span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%11d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">nd</span><span class="o">.</span><span class="n">index</span> <span class="o">+</span><span class="s1">&#39;        &#39;</span><span class="p">)</span>
			<span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%14.8f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">nd</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;        &#39;</span><span class="p">)</span>
			<span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%14.8f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">nd</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;        &#39;</span><span class="p">)</span>
			<span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%14.8f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">nd</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
			<span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
		<span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">0</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
		<span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;elem</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
		<span class="c1">#if self._full_connectivity:</span>
		<span class="c1">#	outfile.write(str(len(self.elemlist[0].nodes))+&#39; &#39;+str(len(self.elemlist))+&#39;\n&#39;)		</span>
		<span class="c1">#	for el in self.elemlist:</span>
		<span class="c1">#		outfile.write(str(int(el.index))+&#39;   &#39;)</span>
		<span class="c1">#		for nd in el.nodes:</span>
		<span class="c1">#			outfile.write(str(nd.index)+&#39;   &#39;)</span>
		<span class="c1">#		outfile.write(&#39;\n&#39;)</span>
		<span class="c1">#else:</span>
		<span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">elemlist</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span><span class="o">+</span><span class="s1">&#39; &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">elemlist</span><span class="p">))</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>		
		<span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">el</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">elemlist</span><span class="p">):</span>
			<span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;   &#39;</span><span class="p">)</span>
			<span class="k">for</span> <span class="n">nd</span> <span class="ow">in</span> <span class="n">el</span><span class="p">:</span>
				<span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">nd</span><span class="o">.</span><span class="n">index</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;   &#39;</span><span class="p">)</span>
			<span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
		<span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">stop</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
		<span class="n">outfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
	<span class="k">def</span> <span class="nf">refresh</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;Generate grid node and element objects corresponding to x y and z seeds.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="c1"># first determine dimension of grid</span>
		<span class="n">xF</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">;</span> <span class="n">yF</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">;</span> <span class="n">zF</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span> <span class="o">!=</span> <span class="kc">None</span>
		<span class="k">if</span> <span class="n">xF</span> <span class="ow">and</span> <span class="n">yF</span> <span class="ow">and</span> <span class="n">zF</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimension</span> <span class="o">=</span> <span class="mi">3</span>
		<span class="k">elif</span> <span class="p">(</span><span class="n">xF</span> <span class="ow">and</span> <span class="n">yF</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">zF</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">xF</span> <span class="ow">and</span> <span class="n">zF</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">yF</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">zF</span> <span class="ow">and</span> <span class="n">yF</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">xF</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimension</span> <span class="o">=</span> <span class="mi">2</span>
		<span class="k">else</span><span class="p">:</span> <span class="nb">print</span> <span class="s1">&#39;ERROR: not enough dimensions specified&#39;</span><span class="p">;</span> <span class="k">return</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimension</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span> <span class="nb">print</span> <span class="s1">&#39;ERROR: two dimensional grids not supported&#39;</span><span class="p">;</span> <span class="k">return</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimension</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
			<span class="c1"># create nodes</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">_nodelist</span> <span class="o">=</span> <span class="p">[]</span>
			<span class="n">ind</span> <span class="o">=</span> <span class="mi">1</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">_z</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_z</span><span class="p">))</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">_x</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_x</span><span class="p">))</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">_y</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_y</span><span class="p">))</span>
			<span class="k">for</span> <span class="n">zi</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_z</span><span class="p">:</span>
				<span class="k">for</span> <span class="n">yi</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y</span><span class="p">:</span>
					<span class="k">for</span> <span class="n">xi</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x</span><span class="p">:</span>
						<span class="bp">self</span><span class="o">.</span><span class="n">_nodelist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fnode</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">ind</span><span class="p">,</span><span class="n">position</span><span class="o">=</span><span class="p">[</span><span class="n">xi</span><span class="p">,</span><span class="n">yi</span><span class="p">,</span><span class="n">zi</span><span class="p">]))</span>
						<span class="n">ind</span> <span class="o">+=</span><span class="mi">1</span>
			
			<span class="c1"># create elements</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">_elemlist</span> <span class="o">=</span> <span class="p">[]</span>
			<span class="n">ind</span> <span class="o">=</span> <span class="mi">1</span>
			<span class="n">xL</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_x</span><span class="p">);</span> <span class="n">yL</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_y</span><span class="p">);</span> <span class="n">zL</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_z</span><span class="p">)</span>
			<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_z</span><span class="p">)):</span>
				<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_y</span><span class="p">)):</span>
					<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_x</span><span class="p">)):</span>
						<span class="n">nodes</span><span class="o">=</span><span class="p">[</span>
							<span class="bp">self</span><span class="o">.</span><span class="n">_nodelist</span><span class="p">[</span><span class="n">i</span><span class="o">*</span><span class="n">xL</span><span class="o">*</span><span class="n">yL</span> <span class="o">+</span> <span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">xL</span> <span class="o">+</span> <span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
							<span class="bp">self</span><span class="o">.</span><span class="n">_nodelist</span><span class="p">[</span><span class="n">i</span><span class="o">*</span><span class="n">xL</span><span class="o">*</span><span class="n">yL</span> <span class="o">+</span> <span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">xL</span> <span class="o">+</span> <span class="n">k</span><span class="p">],</span>
							<span class="bp">self</span><span class="o">.</span><span class="n">_nodelist</span><span class="p">[</span><span class="n">i</span><span class="o">*</span><span class="n">xL</span><span class="o">*</span><span class="n">yL</span> <span class="o">+</span> <span class="n">j</span><span class="o">*</span><span class="n">xL</span> <span class="o">+</span> <span class="n">k</span><span class="p">],</span>
							<span class="bp">self</span><span class="o">.</span><span class="n">_nodelist</span><span class="p">[</span><span class="n">i</span><span class="o">*</span><span class="n">xL</span><span class="o">*</span><span class="n">yL</span> <span class="o">+</span> <span class="n">j</span><span class="o">*</span><span class="n">xL</span> <span class="o">+</span> <span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
							<span class="bp">self</span><span class="o">.</span><span class="n">_nodelist</span><span class="p">[(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">xL</span><span class="o">*</span><span class="n">yL</span> <span class="o">+</span> <span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">xL</span> <span class="o">+</span> <span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
							<span class="bp">self</span><span class="o">.</span><span class="n">_nodelist</span><span class="p">[(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">xL</span><span class="o">*</span><span class="n">yL</span> <span class="o">+</span> <span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">xL</span> <span class="o">+</span> <span class="n">k</span><span class="p">],</span>
							<span class="bp">self</span><span class="o">.</span><span class="n">_nodelist</span><span class="p">[(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">xL</span><span class="o">*</span><span class="n">yL</span> <span class="o">+</span> <span class="n">j</span><span class="o">*</span><span class="n">xL</span> <span class="o">+</span> <span class="n">k</span><span class="p">],</span>
							<span class="bp">self</span><span class="o">.</span><span class="n">_nodelist</span><span class="p">[(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">xL</span><span class="o">*</span><span class="n">yL</span> <span class="o">+</span> <span class="n">j</span><span class="o">*</span><span class="n">xL</span> <span class="o">+</span> <span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
							<span class="p">]</span>
						<span class="c1">#if self._full_connectivity:</span>
						<span class="c1">#	self._elemlist.append(felem(index=ind,nodes=nodes))</span>
						<span class="c1">#	ind +=1</span>
						<span class="c1">#else:</span>
						<span class="bp">self</span><span class="o">.</span><span class="n">_elemlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nodes</span><span class="p">)</span>
	<span class="k">def</span> <span class="nf">_get_x</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x</span>
	<span class="k">def</span> <span class="nf">_set_x</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">value</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x</span> <span class="o">=</span> <span class="n">value</span>
	<span class="n">x</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_get_x</span><span class="p">,</span> <span class="n">_set_x</span><span class="p">)</span> <span class="c1">#: (*lst[fl64]*) x coordinates of nodes.</span>
	<span class="k">def</span> <span class="nf">_get_y</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y</span>
	<span class="k">def</span> <span class="nf">_set_y</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">value</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y</span> <span class="o">=</span> <span class="n">value</span>
	<span class="n">y</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_get_y</span><span class="p">,</span> <span class="n">_set_y</span><span class="p">)</span> <span class="c1">#: (*lst[fl64]*) y coordinates of nodes.</span>
	<span class="k">def</span> <span class="nf">_get_z</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_z</span>
	<span class="k">def</span> <span class="nf">_set_z</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">value</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">_z</span> <span class="o">=</span> <span class="n">value</span>
	<span class="n">z</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_get_z</span><span class="p">,</span> <span class="n">_set_z</span><span class="p">)</span> <span class="c1">#: (*lst[fl64]*) z coordinates of nodes.</span>
	<span class="k">def</span> <span class="nf">_get_meshname</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meshname</span>
	<span class="k">def</span> <span class="nf">_set_meshname</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">value</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meshname</span> <span class="o">=</span> <span class="n">value</span>
	<span class="n">meshname</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_get_meshname</span><span class="p">,</span> <span class="n">_set_meshname</span><span class="p">)</span> <span class="c1">#: (*str*) Name of grid file to write out.</span>
	<span class="k">def</span> <span class="nf">_get_nodelist</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nodelist</span>
	<span class="k">def</span> <span class="nf">_set_nodelist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">value</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nodelist</span> <span class="o">=</span> <span class="n">value</span>
	<span class="n">nodelist</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_get_nodelist</span><span class="p">,</span> <span class="n">_set_nodelist</span><span class="p">)</span> <span class="c1">#: (*lst[fnode]*) List of node objects in the grid.</span>
	<span class="k">def</span> <span class="nf">_get_elemlist</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_elemlist</span>
	<span class="k">def</span> <span class="nf">_set_elemlist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">value</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">_elemlist</span> <span class="o">=</span> <span class="n">value</span>
	<span class="n">elemlist</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_get_elemlist</span><span class="p">,</span> <span class="n">_set_elemlist</span><span class="p">)</span> <span class="c1">#: (*lst[felem]*) List of element objects in the grid.</span>
</pre></div>

          </div>
            
        </div>
        <div class="clearfix"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">PyFEHM 1.0.4 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >Module code</a> &#187;</li> 
      </ul>
    </div>
<script type="text/javascript">
  $("#mobile-toggle a").click(function () {
    $("#left-column").toggle();
  });
</script>
<script type="text/javascript" src="../_static/js/bootstrap.js"></script>
  <div class="footer">
    &copy; Copyright 2018, Los Alamos National Laboratory. Created using <a href="http://sphinx.pocoo.org/">Sphinx</a>.
  </div>
  </body>
</html>